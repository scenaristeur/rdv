(function(){"use strict";var e={9027:function(e,t,n){var o=n(5102),r=n(9269);function a(e,t,n,o,a,i){const s=(0,r.up)("LayerPanel"),l=(0,r.up)("GeoLoc"),c=(0,r.up)("GeoUsers"),u=(0,r.up)("q-drawer"),d=(0,r.up)("OlMap"),p=(0,r.up)("q-page-container"),g=(0,r.up)("q-layout");return(0,r.wg)(),(0,r.j4)(g,{view:"lHh Lpr lFf"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{modelValue:o.leftDrawerOpen,"onUpdate:modelValue":t[0]||(t[0]=e=>o.leftDrawerOpen=e),"show-if-above":"",bordered:"",class:"bg-grey-2"},{default:(0,r.w5)((()=>[(0,r.Wm)(s),(0,r.Wm)(l),(0,r.Wm)(c)])),_:1},8,["modelValue"]),(0,r.Wm)(p,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d)])),_:1})])),_:1})}n(1827);const i=e=>((0,r.dD)("data-v-2a2e1743"),e=e(),(0,r.Cn)(),e),s=i((()=>(0,r._)("div",{id:"map"},null,-1)));function l(e,t,n,o,a,i){const l=(0,r.up)("MapPopup"),c=(0,r.up)("q-page");return(0,r.wg)(),(0,r.j4)(c,{class:"flex flex-center"},{default:(0,r.w5)((()=>[s,(0,r.Wm)(l)])),_:1})}var c=n(6306),u=n(8318),d=n(5941),p=n(9959);const g={id:"popup",class:"ol-popup"},m=(0,r._)("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"},null,-1),f={id:"popup-content"};function h(e,t,n,o,a,i){const s=(0,r.up)("q-table"),l=(0,r.up)("q-pagination");return(0,r.wg)(),(0,r.iD)("div",g,[m,(0,r._)("div",f,[(0,r.Wm)(s,{title:a.title,rows:a.rows,columns:a.columns,"row-key":"key",separator:a.separator,pagination:a.table_pagination,"onUpdate:pagination":t[0]||(t[0]=e=>a.table_pagination=e)},null,8,["title","rows","columns","separator","pagination"]),(0,r.Wm)(l,{modelValue:a.current,"onUpdate:modelValue":[t[1]||(t[1]=e=>a.current=e),i.onPageChange],color:"purple",max:a.maxPage,"max-pages":10,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])])])}n(4719);var w=n(350),y=n(1552),v=n(4610),b=n(2146),k={name:"MapPopup",data(){return{title:"",rows:[],columns:[],current:1,maxPage:0,featureProps:[],separator:"cell",table_pagination:{page:1},highlight_layer:""}},methods:{addClick(){let e=new b.Z({source:new v.Z({})});this.map.addLayer(e);let t=document.getElementById("popup"),n=document.getElementById("popup-closer");const o=new w.Z({element:t,autoPan:{animation:{duration:250}}});n.onclick=function(){return e.getSource().clear(),this.table_pagination={page:1},this.current=1,o.setPosition(void 0),n.blur(),!1},this.title="dummy",this.map.addOverlay(o);let r=this;this.map.on("singleclick",(function(t){if(r.current=1,e.getSource().clear(),r.featureProps=[],r.maxPage=0,t.target.forEachFeatureAtPixel(t.pixel,((e,t)=>{let n={};n.title=t.get("name"),n.columns=[{name:"key",label:"Key",field:"key"},{name:"value",label:"Value",field:"value"}],n.rows=[],n.geom="";let o=e.getProperties();for(let r in o)"geometry"!=r?n.rows.push({key:r.toUpperCase(),value:o[r]}):n.geom=o[r];r.featureProps.push(n),r.maxPage+=1})),r.featureProps.length){r.title=r.featureProps[0].title,r.columns=r.featureProps[0].columns,r.rows=r.featureProps[0].rows;let n=new y["default"]({geometry:r.featureProps[0].geom});e.getSource().addFeature(n);const a=t.coordinate;o.setPosition(a)}})),r.highlight_layer=e},onPageChange(e){this.highlight_layer.getSource().clear(),this.table_pagination={page:1},this.title=this.featureProps[e-1].title,this.columns=this.featureProps[e-1].columns,this.rows=this.featureProps[e-1].rows;let t=new y["default"]({geometry:this.featureProps[e-1].geom});this.highlight_layer.getSource().addFeature(t)}},watch:{map:{handler(){this.addClick()},deep:!1}},computed:{map(){return this.$store.state.map}}},_=n(7617),P=n(8670),Z=n(9034),L=n(1410),x=n.n(L);const S=(0,_.Z)(k,[["render",h]]);var I=S;x()(k,"components",{QTable:P.Z,QPagination:Z.Z});var D={name:"OlMap",components:{MapPopup:I},mounted(){this.map=new c.Z({target:"map",layers:[new d.Z({source:new p.Z,name:"OSM"})],view:new u.ZP({center:[0,0],zoom:2})}),this.$store.commit("setMap",this.map)}},O=n(8906);const T=(0,_.Z)(D,[["render",l],["__scopeId","data-v-2a2e1743"]]);var C=T;x()(D,"components",{QPage:O.Z});const Q=(0,r._)("div",{id:"info",style:{display:"none"}},null,-1),M={for:"track"},q=(0,r.uE)('<p> position accuracy : <code id="accuracy"></code><br> altitude : <code id="altitude"></code><br> altitude accuracy : <code id="altitudeAccuracy"></code><br> heading : <code id="heading"></code><br> speed : <code id="speed"></code></p>',1);function A(e,t,n,o,a,i){return(0,r.wg)(),(0,r.iD)("div",null,[Q,(0,r._)("label",M,[(0,r.Uk)(" track position "),(0,r._)("input",{id:"track",type:"checkbox",onClick:t[0]||(t[0]=(...e)=>i.trackPosition&&i.trackPosition(...e))})]),q])}var W=n(5950),V=n(5225),E=n(1308),F=n(1375),U=n(4511),j=n(3814),z=n(5422),G=n(771),H=n(5386),$=n(2876),B=n(835);const N={events:{}},K=(0,G.wI)(N),J=(0,G.ms)(K),Y=new B.GL(J),R=new H.x$("rdv",J,{awareness:Y,signaling:["wss://noosld-webrtc.glitch.me"]}),X=new $.VU("wss://rdv.glitch.me/rdv","rdv",J,{awareness:Y});R.on("status",(e=>{console.log("** webrtcProvider in y_store",e.status)})),X.on("status",(e=>{console.log("## websocketProvider in y_store",e.status)}));let ee="user_"+Date.now();var te={name:"GeoLoc",data(){return{position:null,markers:[],follow_me:!0}},methods:{trackPosition(e){console.log(e.target.checked,this.map.view),1==e.target.checked&&this.init()},init(){var e=new u.ZP({center:[0,0],zoom:4});this.map.view=e;let t=this;Y.setLocalStateField("user",{name:ee,color:"#ffb61e"});var n=new W.Z({trackingOptions:{enableHighAccuracy:!0}});function o(e){return document.getElementById(e)}o("track").addEventListener("change",(function(){n.setTracking(this.checked)})),n.on("change",(function(){console.log(n);var e=n.getPosition();console.log("me",e),t.updateAwarenessPosition(e),o("accuracy").innerText=n.getAccuracy()+" [m]",o("altitude").innerText=n.getAltitude()+" [m]",o("altitudeAccuracy").innerText=n.getAltitudeAccuracy()+" [m]",o("heading").innerText=n.getHeading()+" [rad]",o("speed").innerText=n.getSpeed()+" [m/s]",t.map.view.setCenter(e)})),n.on("error",(function(e){var t=document.getElementById("info");t.innerHTML=e.message,t.style.display=""}));var r=new y["default"];n.on("change:accuracyGeometry",(function(){r.setGeometry(n.getAccuracyGeometry())}));var a=new y["default"];a.setStyle(new F["default"]({image:new U["default"]({radius:6,fill:new j["default"]({color:"#3399CC"}),stroke:new z["default"]({color:"#fff",width:2})})})),n.on("change:position",(function(){var e=n.getPosition();a.setGeometry(e?new V["default"](e):null),t.updateAwarenessPosition(e),this.follow_me&&(t.map.view.setCenter(n.getPosition()),t.map.view.setZoom(5))})),new E.Z({map:t.map,source:new v.Z({features:[r,a]})})},updateAwarenessPosition(e){console.log(e),Y.setLocalStateField("position",{coordinates:e,updated:Date.now()})}},watch:{map:{handler(){this.init()},deep:!1}},computed:{map(){return this.$store.state.map}}};const ne=(0,_.Z)(te,[["render",A]]);var oe=ne,re=n(3201);const ae={key:0},ie=["onClick"];function se(e,t,n,o,a,i){const s=(0,r.up)("q-tab"),l=(0,r.up)("q-tabs"),c=(0,r.up)("q-item-section"),u=(0,r.up)("q-icon"),d=(0,r.up)("q-item"),p=(0,r.up)("q-separator"),g=(0,r.up)("InLegend"),m=(0,r.up)("q-list");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(l,{modelValue:a.tab,"onUpdate:modelValue":t[0]||(t[0]=e=>a.tab=e),"inline-label":"",class:"bg-green text-white"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{name:"layers",icon:"layers",label:"Layers"})])),_:1},8,["modelValue"]),null!=i.map?((0,r.wg)(),(0,r.iD)("span",ae,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(i.map.getLayers().getArray().slice().reverse(),((e,t)=>((0,r.wg)(),(0,r.j4)(m,{separator:"",bordered:"",clickable:"",key:t},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{style:{height:"10px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(c,{avatar:""},{default:(0,r.w5)((()=>[e.get("isBaseMap")?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("span",{key:0,class:"material-symbols-outlined cursor-pointer",style:{color:"#54b582","font-size":"40px","font-variation-settings":"'FILL' 0"},onClick:t=>i.toggleLayer(e,t)}," check_circle ",8,ie))])),_:2},1024),(0,r.Wm)(c,{class:"label_align"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,re.zw)(e.get("name")),1)])),_:2},1024),(0,r.Wm)(c,{avatar:""},{default:(0,r.w5)((()=>[e.get("isBaseMap")?(0,r.kq)("",!0):((0,r.wg)(),(0,r.j4)(u,{key:0,name:"keyboard_arrow_down",class:"expansion_align cursor-pointer",size:"25px",onClick:t=>i.toggleSwitch(e,t)},null,8,["onClick"]))])),_:2},1024)])),_:2},1024),(0,r.Wm)(p),(0,r.Wm)(g,{layer:e},null,8,["layer"])])),_:2},1024)))),128))])):(0,r.kq)("",!0)])}var le=n(1780),ce=n(9708),ue=n.n(ce);let de=[];var pe=de;const ge={key:0,style:{"margin-top":"10px"}},me={key:0},fe=["onClick"],he=["innerHTML"];function we(e,t,n,o,a,i){return(0,r.wg)(),(0,r.iD)("span",null,[n.layer.get("isExpanded")?((0,r.wg)(),(0,r.iD)("div",ge,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(n.layer.geostyle.rules,((e,t)=>((0,r.wg)(),(0,r.iD)("div",{key:t},[n.layer.geostyle.rules.length>1?((0,r.wg)(),(0,r.iD)("span",me,[(0,r._)("span",{class:"material-symbols-outlined cursor-pointer",style:{color:"#54b582","font-size":"32px","font-variation-settings":"'FILL' 1","vertical-align":"top"},onClick:e=>i.toggleSubLayer(n.layer,t,e)}," check_circle ",8,fe)])):(0,r.kq)("",!0),(0,r._)("span",{ref_for:!0,ref:`legend-vector-${n.layer.get("name")}-${t}`,innerHTML:i.renderLegend(n.layer,t)},null,8,he)])))),128))])):(0,r.kq)("",!0)])}var ye=n(2677),ve=n.n(ye),be={name:"InLegend",props:["layer"],methods:{renderLegend(e,t){setTimeout((()=>{let n=this.$refs[`legend-vector-${e.get("name")}-${t}`],o={rules:[e.geostyle.rules[t]]};const r=new(ve())({maxColumnWidth:240,overflow:"group",styles:[o],size:[230,300],hideRect:!1,iconSize:[100,100]});r.render(n[0])}),10)},toggleSubLayer(e,t,n){e.geostyle.rules[t]["filter"][0]?(e.geostyle.rules[t]["filter"][0]="",n.target.style.fontVariationSettings='"FILL" 0'):(e.geostyle.rules[t]["filter"][0]=e.geostyleTwin.rules[t]["filter"][0],n.target.style.fontVariationSettings='"FILL" 1'),e.getSource().changed()}}};const ke=(0,_.Z)(be,[["render",we]]);var _e=ke;const Pe=new(ue());var Ze={name:"LayersPanel",data(){return{splitterModel:1,tab:"mails"}},components:{InLegend:_e},watch:{map:{handler(){this.addLayers()},deep:!1}},computed:{map(){return this.$store.state.map}},methods:{addLayers(){pe.forEach((e=>{let t=new b.Z({source:new v.Z({features:new le.Z({featureProjection:"EPSG:3857"}).readFeatures(e.layer)}),name:e.name,minZoom:e.minZoom,visible:e.visible,isExpanded:!1});t.geostyle=e.style,t.geostyleTwin=JSON.parse(JSON.stringify(e.style)),e.style&&Pe.writeStyle(e.style).then((({output:e})=>t.setStyle(e))).catch((e=>console.log(e))),this.map.addLayer(t)}))},toggleLayer(e,t){let n=e.getVisible();e.setVisible(!n),t.target.style.fontVariationSettings=0==n?'"FILL" 1':'"FILL" 0'},toggleSwitch(e,t){let n=e.get("isExpanded");e.set("isExpanded",!n),t.target.innerHTML=0==n?"keyboard_arrow_up":"keyboard_arrow_down"}}},Le=n(3554),xe=n(5748),Se=n(8531),Ie=n(5246),De=n(2278),Oe=n(9109),Te=n(4633),Ce=n(6269);const Qe=(0,_.Z)(Ze,[["render",se],["__scopeId","data-v-747b0cb2"]]);var Me=Qe;x()(Ze,"components",{QTabs:Le.Z,QTab:xe.Z,QList:Se.Z,QItem:Ie.Z,QItemSection:De.Z,QCheckbox:Oe.Z,QIcon:Te.Z,QSeparator:Ce.Z});const qe=(0,r._)("hr",null,null,-1),Ae=(0,r._)("br",null,null,-1);function We(e,t,n,o,a,i){return(0,r.wg)(),(0,r.iD)("div",null,[qe,(0,r.Uk)(" me "+(0,re.zw)(a.clientID)+" , users : "+(0,re.zw)(a.features.length)+" ",1),Ae,(0,r.Uk)(" "+(0,re.zw)(a.users),1)])}var Ve=n(6327),Ee=n(6311),Fe=n.p+"img/marker.f58b9982.png",Ue={name:"GeoUsers",data(){return{clientID:null,users:{},features:[]}},methods:{init(){const e=new v.Z({features:this.features}),t=new E.Z({source:e});this.map.addLayer(t),this.clientID=Y.clientID,console.log("init geousers",Y.clientID),Y.on("change",(()=>{Y.getStates().forEach(this.setUserMarker),console.log("users",this.users)}))},setUserMarker(e,t){if(t!=Y.clientID&&e.position&&e.position.coordinates){let n={clientID:t,name:e.user.name||"anon",position:e.position.coordinates};console.log("set marker",t,n),this.users[t]=n;let o=new y["default"]({geometry:new V["default"]((0,Ve.mi)([12.5,41.9]))});o.setStyle(new F["default"]({image:new Ee["default"]({color:"#BADA55",crossOrigin:"anonymous",src:Fe,scale:.05})})),this.features.push(o)}}},watch:{map:{handler(){this.init()},deep:!1}},computed:{map(){return this.$store.state.map}}};const je=(0,_.Z)(Ue,[["render",We]]);var ze=je,Ge=n(6237),He=n(6957),$e={name:"App",components:{OlMap:C,LayerPanel:Me,GeoLoc:oe,GeoUsers:ze},computed:{...(0,He.Se)("map",{map:"map"})},setup(){return{leftDrawerOpen:(0,Ge.iH)(!1)}}},Be=n(2446),Ne=n(7454),Ke=n(366),Je=n(9804),Ye=n(8623),Re=n(2709),Xe=n(3712),et=n(6974);const tt=(0,_.Z)($e,[["render",a]]);var nt=tt;x()($e,"components",{QLayout:Be.Z,QHeader:Ne.Z,QToolbar:Ke.Z,QBtn:Je.Z,QToolbarTitle:Ye.Z,QDrawer:Re.Z,QList:Se.Z,QItemLabel:Xe.Z,QItem:Ie.Z,QItemSection:De.Z,QIcon:Te.Z,QPageContainer:et.Z});var ot=n(5563);(0,ot.z)("/rdv/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh."),alert("This app has been updated, please close the app & re-open")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var rt=(0,He.MT)({state:{map:null},getters:{},mutations:{setMap(e,t){e.map=t}},actions:{},modules:{}}),at=n(751),it=n(7586),st=n.n(it),lt={config:{},plugins:{},lang:st()};(0,o.ri)(nt).use(at.Z,lt).use(rt).mount("#app")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,o,r,a){if(!o){var i=1/0;for(u=0;u<e.length;u++){o=e[u][0],r=e[u][1],a=e[u][2];for(var s=!0,l=0;l<o.length;l++)(!1&a||i>=a)&&Object.keys(n.O).every((function(e){return n.O[e](o[l])}))?o.splice(l--,1):(s=!1,a<i&&(i=a));if(s){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[o,r,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/rdv/"}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,a,i=o[0],s=o[1],l=o[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(l)var u=l(n)}for(t&&t(o);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(u)},o=self["webpackChunkrdv"]=self["webpackChunkrdv"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(9027)}));o=n.O(o)})();
//# sourceMappingURL=app.a41c7c22.js.map