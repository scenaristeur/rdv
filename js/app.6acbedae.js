(function(){"use strict";var e={4301:function(e,t,o){var r=o(9242),n=o(3396);function i(e,t){const o=(0,n.up)("router-view");return(0,n.wg)(),(0,n.j4)(o)}var s=o(89);const l={},a=(0,s.Z)(l,[["render",i]]);var u=a,c=o(5431);(0,c.z)("/rdv/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh."),alert("This app has been updated, please close the app & re-open")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var d=o(2483);const f={class:"home"};function p(e,t,o,r,i,s){const l=(0,n.up)("MapComponent"),a=(0,n.up)("ProfileView"),u=(0,n.up)("UsersView");return(0,n.wg)(),(0,n.iD)("div",f,[(0,n.Wm)(l),(0,n.Wm)(a),(0,n.Wm)(u)])}function h(e,t,o,r,i,s){const l=(0,n.up)("ol-view"),a=(0,n.up)("ol-source-osm"),u=(0,n.up)("ol-tile-layer"),c=(0,n.up)("ol-geom-point"),d=(0,n.up)("ol-style-icon"),f=(0,n.up)("ol-style"),p=(0,n.up)("ol-feature"),h=(0,n.up)("ol-source-vector"),m=(0,n.up)("ol-vector-layer"),g=(0,n.up)("ol-geolocation"),v=(0,n.up)("ol-geom-multi-point"),w=(0,n.up)("ol-style-fill"),k=(0,n.up)("ol-style-stroke"),y=(0,n.up)("ol-style-text"),b=(0,n.up)("ol-style-circle"),M=(0,n.up)("ol-map");return(0,n.wg)(),(0,n.j4)(M,{loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,style:{height:"400px"},ref:"map"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{ref:"view",center:i.center,rotation:i.rotation,zoom:i.zoom,projection:i.projection},null,8,["center","rotation","zoom","projection"]),(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Wm)(a)])),_:1}),(0,n.Wm)(g,{projection:i.projection,"onChange:position":s.geoLocChange},{default:(0,n.w5)((()=>[(0,n._)("template",null,[(0,n.Wm)(m,{zIndex:2},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{ref:"positionFeature"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{coordinates:i.position},null,8,["coordinates"]),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:i.hereIcon,scale:.1},null,8,["src"])])),_:1})])),_:1},512)])),_:1})])),_:1})])])),_:1},8,["projection","onChange:position"]),(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.users,((e,t)=>((0,n.wg)(),(0,n.j4)(p,{key:t},{default:(0,n.w5)((()=>[void 0!=e.position?((0,n.wg)(),(0,n.j4)(v,{key:0,coordinates:e.position.coordinates},null,8,["coordinates"])):(0,n.kq)("",!0),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{radius:i.radius,onClick:s.userMapClicked},{default:(0,n.w5)((()=>[(0,n.Wm)(w,{color:i.fillColor},null,8,["color"]),(0,n.Wm)(k,{color:e.profile.color,width:i.strokeWidth},null,8,["color","width"]),(0,n.Wm)(y,{text:e.profile.name},null,8,["text"])])),_:2},1032,["radius","onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},512)}var m=o(5469),g=o(1330),v={name:"MapComponent",components:{},data(){return{initialisation:!0,center:[47.41322,-1.219482],rotation:0,zoom:14,projection:"EPSG:4326",position:[],hereIcon:m,radius:10,strokeWidth:4,strokeColor:"red",fillColor:"white",coordinates:[]}},methods:{geoLocChange(e){this.position=e.target.getPosition(),this.$store.commit("core/updateMyPosition",this.position),1==this.centerMe&&this.$refs.view.setCenter(this.position),g.kW.setLocalStateField("position",{coordinates:this.position,updated:Date.now()})},userMapClicked(e){console.log(e)},updateUserMarkers(){console.log("users in map",this.users)}},watch:{users(){this.updateUserMarkers()},centerMe(){1==this.centerMe&&(console.log("center me",this.centerMe),this.$refs.view.setCenter(this.position))},centerUser(){console.log(this.centerUser),this.$refs.view.setCenter(this.centerUser)}},computed:{users(){return this.$store.state.core.users},centerMe(){return this.$store.state.core.centerMe},centerUser(){return this.$store.state.core.centerUser}}};const w=(0,s.Z)(v,[["render",h]]);var k=w,y=o(7139);function b(e,t,o,r,i,s){const l=(0,n.up)("BButton"),a=(0,n.up)("BFormInput"),u=(0,n.up)("BListGroupItem"),c=(0,n.up)("BListGroup"),d=(0,n.up)("BModal");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("div",null,[(0,n.Wm)(l,{onClick:t[0]||(t[0]=e=>i.showProfile=!i.showProfile)},{default:(0,n.w5)((()=>[(0,n.Uk)(" Profile")])),_:1}),(0,n.Wm)(l,{onClick:s.followMe},{default:(0,n.w5)((()=>[(0,n.Uk)((0,y.zw)(1==s.centerMe?"don't follow me":"follow me"),1)])),_:1},8,["onClick"]),(0,n.Wm)(d,{modelValue:i.showProfile,"onUpdate:modelValue":t[3]||(t[3]=e=>i.showProfile=e),onOk:s.updateUser},{default:(0,n.w5)((()=>[(0,n.Wm)(a,{modelValue:i.user.name,"onUpdate:modelValue":t[1]||(t[1]=e=>i.user.name=e),placeholder:"username"},null,8,["modelValue"]),(0,n.Wm)(a,{modelValue:i.user.color,"onUpdate:modelValue":t[2]||(t[2]=e=>i.user.color=e),type:"color"},null,8,["modelValue"]),(0,n.Uk)(" "+(0,y.zw)(s.profile)+" ",1),(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.profiles,(e=>((0,n.wg)(),(0,n.j4)(u,{key:e.id,href:"#",active:s.profile==e.id,onClick:t=>s.changeProfile(e.id)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,y.zw)(e.name),1)])),_:2},1032,["active","onClick"])))),128))])),_:1})])),_:1},8,["modelValue","onOk"])])])}var M={name:"ProfileView",data(){return{showProfile:!1,user:{name:"user_"+Date.now(),color:"#ffb61e",clientID:g.kW.clientID}}},created(){let e=JSON.parse(localStorage.getItem("rdv_user"));console.log("localstorage user",e),e&&e.name&&e.color&&(this.user=e),g.kW.setLocalStateField("profile",this.user),this.updateInterests()},methods:{updateUser(){console.log("User",this.user),g.kW.setLocalStateField("profile",this.user),localStorage.setItem("rdv_user",JSON.stringify(this.user))},changeProfile(e){console.log(e),this.$store.commit("core/setProfile",e)},updateInterests(){console.log("update interests"),g.kW.setLocalStateField("interests",{like:this.profiles[this.profile]})},followMe(){console.log(this.centerMe),this.$store.commit("core/centerMe",!this.centerMe)}},watch:{profiles(){this.updateInterests()},profile(){this.updateInterests()}},computed:{profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile},centerMe(){return this.$store.state.core.centerMe}}};const _=(0,s.Z)(M,[["render",b]]);var C=_;const W={key:1};function P(e,t,o,r,i,s){const l=(0,n.up)("BBadge"),a=(0,n.up)("BListGroupItem"),u=(0,n.up)("BListGroup");return(0,n.wg)(),(0,n.iD)("div",null,[i.users.length>0?((0,n.wg)(),(0,n.j4)(u,{key:0,class:"users_list"},{default:(0,n.w5)((()=>[(0,n._)("div",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.users,(e=>((0,n.wg)(),(0,n.j4)(a,{key:e.profile.clientID,href:"#",onClick:t=>s.userClicked(e)},{default:(0,n.w5)((()=>[(0,n._)("h2",null,(0,y.zw)(e.profile.name),1),(0,n._)("div",{class:"user_color",style:(0,y.j5)("width:20px;height:20px;background-color:"+e.profile.color)},null,4),(0,n.Uk)(" distance : "+(0,y.zw)(e.distance>1?e.distance+" km":Math.floor(1e3*e.distance)+" m")+" ",1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.interests.like.interests,(e=>((0,n.wg)(),(0,n.j4)(l,{key:e,variant:s.profiles[s.profile].interests.includes(e)?"info":"light"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,y.zw)(e),1)])),_:2},1032,["variant"])))),128))])),_:2},1032,["onClick"])))),128))])])),_:1})):((0,n.wg)(),(0,n.iD)("div",W," Recherche des voisins "))])}var U=o(6866),j=o(5288);(0,j.QB)(U);var D={name:"UsersView",data(){return{users:[],awareness:g.kW}},created(){(0,j.QT)(g.h.rdvs,this.rdvsUpdate),g.kW.on("change",(()=>{this.updateUsers(Array.from(g.kW.getStates().values()).filter((e=>e.profile.clientID!=g.kW.clientID)))}))},methods:{userClicked(e){console.log(e),void 0!=e.position&&this.$store.commit("core/centerToUser",e.position.coordinates)},rdvsUpdate(e){console.log("RDVUPDATE",e)},updateUsers(e){console.log("UPDATE USERS",e),this.users=this.withDistances(e).sort((function(e,t){return e.distance-t.distance})),this.$store.commit("core/setUsers",this.users)},withDistances(e){let t=e.map((e=>{var t=Object.assign({},e);if(void 0!=e.position){const o=this.getDistanceFromLatLonInKm(this.myPosition[0],this.myPosition[1],e.position.coordinates[0],e.position.coordinates[1]).toFixed(3);t.distance=o}return t}));return t},getDistanceFromLatLonInKm(e,t,o,r){var n=6371,i=this.deg2rad(o-e),s=this.deg2rad(r-t),l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(o))*Math.sin(s/2)*Math.sin(s/2),a=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),u=n*a;return u},deg2rad(e){return e*(Math.PI/180)}},computed:{myPosition(){return this.$store.state.core.myPosition},profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile}}};const I=(0,s.Z)(D,[["render",P],["__scopeId","data-v-780d0be2"]]);var S=I,L={name:"MapView",components:{MapComponent:k,ProfileView:C,UsersView:S}};const O=(0,s.Z)(L,[["render",p]]);var T=O;const V=[{path:"/",name:"home",component:T},{path:"/about",name:"about",component:()=>o.e(443).then(o.bind(o,5709))}],$=(0,d.p7)({history:(0,d.PO)("/rdv/"),routes:V});var x=$,A=o(65);const B=()=>({level:0,profiles:[{id:0,name:"js +bad",interests:["js","badminton","velo"]},{id:1,name:"js +tricot",interests:["js","tricot","natation"]},{id:2,name:"react + tricot",interests:["react","tricot","tracteurs"]}],profile:Math.floor(3*Math.random()),myPosition:[],users:[],centerMe:!0,centerUser:[]}),E={incrementLevel(e){e.level=e.level+1,console.log(e.level)},updateMyPosition(e,t){e.myPosition=t},setUsers(e,t){e.users=t},setProfile(e,t){e.profile=t},centerMe(e,t){e.centerMe=t},centerToUser(e,t){e.centerUser=t}},F={};var N={namespaced:!0,state:B,actions:F,mutations:E},z=(0,A.MT)({state:{},getters:{},mutations:{},actions:{},modules:{core:N}}),K=o(2026),Z=o(7474);(0,r.ri)(u).use(z).use(x).use(K.ZP).use(g.h).use(Z.ZP).mount("#app")},1330:function(e,t,o){o.d(t,{h:function(){return a},kW:function(){return c}});var r=o(5288),n=o(9373),i=o(2213),s=o(114);const l={rdvs:{}},a=(0,r.wI)(l),u=(0,r.ms)(a),c=new s.GL(u),d=new n.x$("rdv",u,{awareness:c,signaling:["wss://noosld-webrtc.glitch.me"]}),f=new i.VU("wss://yjs-leveldb.glitch.me/rdv","rdv",u,{awareness:c});d.on("status",(e=>{console.log("** webrtcProvider in y_store",e.status)})),f.on("status",(e=>{console.log("## websocketProvider in y_store",e.status)}))},5469:function(e,t,o){e.exports=o.p+"img/here.b7fe6ce7.png"}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,o),i.exports}o.m=e,function(){var e=[];o.O=function(t,r,n,i){if(!r){var s=1/0;for(c=0;c<e.length;c++){r=e[c][0],n=e[c][1],i=e[c][2];for(var l=!0,a=0;a<r.length;a++)(!1&i||s>=i)&&Object.keys(o.O).every((function(e){return o.O[e](r[a])}))?r.splice(a--,1):(l=!1,i<s&&(s=i));if(l){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[r,n,i]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,r){return o.f[r](e,t),t}),[]))}}(),function(){o.u=function(e){return"js/about.0db148b7.js"}}(),function(){o.miniCssF=function(e){return"css/about.9dcd382b.css"}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="rdv:";o.l=function(r,n,i,s){if(e[r])e[r].push(n);else{var l,a;if(void 0!==i)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+i){l=d;break}}l||(a=!0,l=document.createElement("script"),l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.setAttribute("data-webpack",t+i),l.src=r),e[r]=[n];var f=function(t,o){l.onerror=l.onload=null,clearTimeout(p);var n=e[r];if(delete e[r],l.parentNode&&l.parentNode.removeChild(l),n&&n.forEach((function(e){return e(o)})),t)return t(o)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),a&&document.head.appendChild(l)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/rdv/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,o,r,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var s=function(o){if(i.onerror=i.onload=null,"load"===o.type)r();else{var s=o&&("load"===o.type?"missing":o.type),l=o&&o.target&&o.target.href||t,a=new Error("Loading CSS chunk "+e+" failed.\n("+l+")");a.code="CSS_CHUNK_LOAD_FAILED",a.type=s,a.request=l,i.parentNode&&i.parentNode.removeChild(i),n(a)}};return i.onerror=i.onload=s,i.href=t,o?o.parentNode.insertBefore(i,o.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var o=document.getElementsByTagName("link"),r=0;r<o.length;r++){var n=o[r],i=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(i===e||i===t))return n}var s=document.getElementsByTagName("style");for(r=0;r<s.length;r++){n=s[r],i=n.getAttribute("data-href");if(i===e||i===t)return n}},r=function(r){return new Promise((function(n,i){var s=o.miniCssF(r),l=o.p+s;if(t(s,l))return n();e(r,l,null,n,i)}))},n={143:0};o.f.miniCss=function(e,t){var o={443:1};n[e]?t.push(n[e]):0!==n[e]&&o[e]&&t.push(n[e]=r(e).then((function(){n[e]=0}),(function(t){throw delete n[e],t})))}}}(),function(){var e={143:0};o.f.j=function(t,r){var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise((function(o,r){n=e[t]=[o,r]}));r.push(n[2]=i);var s=o.p+o.u(t),l=new Error,a=function(r){if(o.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",l.name="ChunkLoadError",l.type=i,l.request=s,n[1](l)}};o.l(s,a,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,i,s=r[0],l=r[1],a=r[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(n in l)o.o(l,n)&&(o.m[n]=l[n]);if(a)var c=a(o)}for(t&&t(r);u<s.length;u++)i=s[u],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(c)},r=self["webpackChunkrdv"]=self["webpackChunkrdv"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=o.O(void 0,[998],(function(){return o(4301)}));r=o.O(r)})();
//# sourceMappingURL=app.6acbedae.js.map