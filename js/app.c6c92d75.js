(function(){"use strict";var e={2669:function(e,t,o){var r=o(9242),i=o(3396);function l(e,t){const o=(0,i.up)("router-view");return(0,i.wg)(),(0,i.j4)(o)}var s=o(89);const n={},a=(0,s.Z)(n,[["render",l]]);var d=a,u=o(5431);(0,u.z)("/rdv/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh."),alert("This app has been updated, please close the app & re-open")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var c=o(2483);const p={class:"home"};function m(e,t,o,r,l,s){const n=(0,i.up)("WorldMap"),a=(0,i.up)("ProfileView"),d=(0,i.up)("UsersView"),u=(0,i.up)("RdvView"),c=(0,i.up)("RdvUpdater");return(0,i.wg)(),(0,i.iD)("div",p,[(0,i.Wm)(n,{value:s.view,users:s.users,rdvs:s.rdvs},null,8,["value","users","rdvs"]),(0,i.Wm)(a),"users"==s.view?((0,i.wg)(),(0,i.j4)(d,{key:0})):(0,i.kq)("",!0),"rdv"==s.view?((0,i.wg)(),(0,i.j4)(u,{key:1})):(0,i.kq)("",!0),(0,i.Wm)(c)])}var f=o(7139),v=o(4870),g=o(65),h=o.p+"img/marker.f58b9982.png",w=o.p+"img/marker_selected.9c72dae0.png",A=o.p+"img/here.b7fe6ce7.png",b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADFUlEQVR4Xu2a/bVNMRDF96vAUwE6eCqgA1SADp4KUAEdoAJU8KiADngVoALWb62bta6Y5EySm+uedSZ/3puPmZ2dyew5OdPG29nG/VcAEAzYOAJxBDZOgAiCLUfgtqTnkh5KOm9gTssa1rS/G9b6KemDpJeSvnvGeY27L+l9o+Npfe8aJXtbAEhzAMQjSZ+WQPAYx85/6XSe9T1r1OzsAYD5AOHuEhM8xr2V9HgJycr/njVmAMCc7yQ9qU3uMe7HwO7/TwYkFtwcBcCi4GfP+dot/GKAPQz1jueoWkytbrKHARYARFmvYYP+u4cTqK+M3gHAjCMQDIgjEDEggmDcAu4L6t+ODyRdZD9/lfRxYM6TvwZRkK8WUtOk5p7tcvkWPE4aAPJxnPfKaIAABHSIt00DwGtAqR+xgjpCT5ueb3hS4R7D0xh2/s3IBJKeNjKhabmZAED3bxXaX+9pdYTMrYLlHIc7HTHBBcRMAEp1hF+7QEjpar9RamPMDcPyRV3v8rZVKfVOuhtnqUicZ7fZVavBGmp5OQj0r+r6XltnMYDdpIaYN+p0+c7nfUbGNuMwCwAr8nPm2X1PgwV5TJhyIxwTAKpI3NWeRjX3XtYxAJghwY/JAGjNdeZpXJ/5cVkVA0YC2chYD7h/9ZnFABaxrsGlpKaUPHF9enVEEwgzASglQoBAemslQqTNlqOrTIRKSU3aIWJC+oDJeS9dkUvJU9OO551nMoC1Ni2GEtirl8OH+DIEE14XhI5FYWh/2SiDpxVEDgEAThITAIFrzlJ89MFxgiPOlwRT6cyfPAD7hgOCVRRdEkq1gLcqAIYid2FwABBfh+PzeLwPiAcSRoCMFyK1K8ejBaxECKXn/WxFKWyk5aWx0lzkFSRaTXrHAwAZWSlz8zjmWaM2T+9DyZRZVusIHuM2/1ASnc63+14WeECewQB0Bcei+mjaaxxpJnl6DwjeNUog9BwBnEdvHOSxdDIMJqDta2rOcuKYACQ1iZ0HfS7vCXar7DO6O6t0et/oAGD1WzjoQDBgEMDVDw8GrH4LBx34A8fSukGbT39pAAAAAElFTkSuQmCC",k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADUElEQVR4Xu2a/ZFNQRDFz0aACBABIkAEiAARIAJEgAjYCBABIkAEiAARUD91p+rtrX13pme6+131bv+zW/VmpnvO9MeZvnOiI5eTI9+/NgA2DzhyBA4RAtclXZN0ZYb9d0lfJX3JPJMsAG5Jui/prqSLlQ0CxEdJp9PfUDyiAeCUX0sCgB4BiIeSACVEIgF4JOmlk9WPJb1yWuvMMlEAcOoPnA1+M3mD67IRALydYt3V0Gmxd5LueS7sDQAuj+tHCqFASLiIJwBkeE4/Q/ACvGFYPAH4dk5tHzZwzwJUhasei3sBQMIj8WUK5ZHEOCReAGSeftmwixd4AAC1/Ww8hvcTR4DoIOQPvOiOcZ0bo9TZAwAy8guD4Uuuaw2lJ6NkywMATvFmIwDPJT2rjOX3p43rfRqg2f9UZANwSdKvyua4LP38nwD4E2Bsq1cBJqB2i4cHtAJA4iPZtUgrAMNenAkAjQ6ydotQVaguLTK0h6HJk3WW04K91e729BDgFS2yiiQIG6Pb0yKAdbsy0HKbpGs0dO328AArD+ASAxeYVwOyP3zCsqFV8IAeJsjmAaKEA27f0i+cO88qmCBGsZHLLTHgOOaHx+3TIwTYU0YjZI6dS2PECwBL5vZygpaKUtXlBQCKiGnrba5q4J4BFlK1qMMTAHr/H3p3ZJxHKS1XaePUs8M9AWBlCynqNXyY/Owq9gYgwwvcTh8gvAGI9gLX048CILIiuGT+yBAoa0fwApe6P088ESGADng97PBCb6abzYP1Qblr3SSzuigAMMTzS5Hbl6AsDyh6PMiRG+k5zz0iPcAjFH5PFx531y9gRAMwGgphrp8JALp6qkJI1s/OAbv6aIryOqxFeC3W2hRtWW/vmIwQKMohSIBQK43EPZuvNU+HNp4dAkVfS2kMj/sMJrh0Okvf/lq+Hbqc/KE8YIkfhNb7fahl5oBdG6DK9A5KUiTpcZUOq/drA2CXJPE/CTJ98yg+lAeUAymlLvWB9KGToGsSG13s0B4wav/w/F4ASFitz2KGjWxcgJ6B+dlcLwCWdzyN9g8P6+oXbgB04r55gOEpWyfG5mmpIcAjBstDBvNuOibAJczP6HtzQId965yyAbDOc8mzavOAPKzXqekvWhOGQSnRji0AAAAASUVORK5CYII=";const y={key:0},_={key:1},D={for:"datePicker"},P=(0,i._)("code",null,"When ?",-1),W={key:0},U=(0,i._)("i",null,"7 days max",-1),S=[U],I={role:"group"},V=(0,i._)("label",{for:"input-live"},[(0,i._)("code",null,"Title:")],-1),C=(0,i._)("label",{for:"textarea"},[(0,i._)("code",null,"Description:")],-1),O=(0,i._)("label",{for:"color"},[(0,i._)("code",null,"Color:")],-1);function B(e,t,o,r,l,s){const n=(0,i.up)("VueDatePicker"),a=(0,i.up)("b-form-input"),d=(0,i.up)("b-form-invalid-feedback"),u=(0,i.up)("b-form-text"),c=(0,i.up)("b-form-textarea"),p=(0,i.up)("b-col"),m=(0,i.up)("b-row"),f=(0,i.up)("BModal");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(f,{modelValue:l.showRdvForm,"onUpdate:modelValue":t[4]||(t[4]=e=>l.showRdvForm=e),onOk:s.onAddRdv,size:"lg"},{default:(0,i.w5)((()=>[0==l.edit?((0,i.wg)(),(0,i.iD)("div",y,"Rdv non modifiable")):(0,i.kq)("",!0),null!=s.rdv?((0,i.wg)(),(0,i.iD)("div",_,[(0,i._)("label",D,[P,(0,i.Uk)(),1==l.edit?((0,i.wg)(),(0,i.iD)("small",W,S)):(0,i.kq)("",!0)]),(0,i.Wm)(n,{id:"datePicker",modelValue:l.date,"onUpdate:modelValue":t[0]||(t[0]=e=>l.date=e),range:"","partial-range":"","max-range":"7","format-locale":l.fr,format:"Pp","min-date":new Date,"max-date":new Date((new Date).setDate((new Date).getDate()+15)),disabled:!l.edit},null,8,["modelValue","format-locale","min-date","max-date","disabled"]),(0,i._)("div",I,[V,(0,i.Wm)(a,{id:"input-live",modelValue:s.rdv.title,"onUpdate:modelValue":t[1]||(t[1]=e=>s.rdv.title=e),state:l.stateTitle,onInput:s.titleState,disabled:!l.edit,"aria-describedby":"input-live-help input-live-feedback",placeholder:"Title",trim:""},null,8,["modelValue","state","onInput","disabled"]),(0,i.Wm)(d,{id:"input-live-feedback"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Enter at least 3 and less than 50 letters ")])),_:1}),(0,i.Wm)(u,{id:"input-live-help"},{default:(0,i.w5)((()=>[(0,i.Uk)("A cool title for your event.")])),_:1})]),C,(0,i.Wm)(c,{id:"textarea",modelValue:s.rdv.description,"onUpdate:modelValue":t[2]||(t[2]=e=>s.rdv.description=e),placeholder:"Description",rows:"3","max-rows":"6",disabled:!l.edit},null,8,["modelValue","disabled"]),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[O,(0,i.Wm)(a,{id:"color",modelValue:s.rdv.color,"onUpdate:modelValue":t[3]||(t[3]=e=>s.rdv.color=e),disabled:!l.edit,type:"color"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])):(0,i.kq)("",!0)])),_:1},8,["modelValue","onOk"])])}var j=o(2108),E=o(8014),M={name:"RdvForm",components:{VueDatePicker:j.Z},data(){return{showRdvForm:!1,fr:E.Z,edit:!0,date:null,stateTitle:!1}},methods:{onAddRdv(){console.log(this.date),null==this.date[1]&&(this.date[1]=this.date[0]),this.rdv.start=this.date[0].toString(),this.rdv.end=this.date[1].toString(),this.rdv.updated=Date.now(),console.log(this.rdv),this.$store.dispatch("core/updateYstoreRdvs",this.rdv)},titleState(){this.stateTitle=1!=this.edit||this.rdv.title.length>2&&this.rdv.title.length<51}},watch:{rdv(){this.showRdvForm=null!=this.rdv,void 0!=this.rdv.start?(this.date=[this.rdv.start,this.rdv.end],console.log(this.date),this.edit=!1):this.edit=!0}},computed:{rdv(){return this.$store.state.core.rdv}}};const R=(0,s.Z)(M,[["render",B]]);var T=R,x={__name:"WorldMap",props:{value:{default:"",type:[String,Number]},users:{type:[Array]},rdvs:{type:[Array]}},setup(e){const t=e,o=(0,i.f3)("ol-feature"),r=(0,i.f3)("ol-geom"),l=(0,v.iH)([2.58,45]),s=(0,v.iH)("EPSG:4326"),n=(0,v.iH)(15),a=(0,v.iH)(0),d=(0,v.iH)("white"),u=(0,v.iH)(1),c=(0,v.iH)(10),p=(0,g.oR)(),m=(0,v.iH)(),y=(0,v.iH)([]),_=(0,v.iH)(!0),D=(0,v.iH)([]);try{const e=localStorage.getItem("rdv_map_view");let t=JSON.parse(e);n.value=t.zoom,l.value=t.center}catch(O){console.log(O)}const P=(0,v.iH)([]);(0,i.YP)((()=>t.users),(()=>{console.log("prop users changed",t.users)})),(0,i.YP)((()=>t.rdvs),(()=>{console.log("prop rdvs changed",t.rdvs);for(let e of Object.values(t.rdvs)){console.log("-----",e.uuid,e.title,e);const t=new o({geometry:new r.Point(e.coordinates),name:e.title,uuid:e.uuid,data:e});D.value.source.addFeature(t)}}));const W=e=>{y.value=e.target.getPosition(),p.commit("core/updateMyPosition",y.value),1==_.value&&m.value?.setCenter(e.target?.getPosition()),localStorage.setItem("rdv_map_view",JSON.stringify({center:m.value.getCenter(),zoom:m.value.getZoom()}))},U=(0,i.Fl)((()=>p.state.core.centerPoint));(0,i.YP)(U,(e=>{m.value?.setCenter(e)}));const S=(0,i.f3)("ol-selectconditions"),I=S.click,V=e=>{if(e.selected.length>0){let t=e.selected[0],o=t.get("uuid"),r=t.get("title");console.log("selected",t,o,r);let i=t.get("name"),l=t.get("data");console.log(i,l,l.description,l.color),p.commit("core/setRdv",l)}},C=(e,t)=>{let o=e.get("color");void 0!=t.getImage().getFill&&t.getImage().getFill().setColor(o);let r=e.get("name");t.getText().setText(r)};return P.value=[{text:"Center map here",icon:b,classname:"some-style-class",callback:e=>{m.value.setCenter(e.coordinate)}},{text:"Add a rdv",classname:"some-style-class",icon:k,callback:e=>{console.log(e),p.commit("core/setRdv",{coordinates:e.coordinate})}},"-"],(t,o)=>{const r=(0,i.up)("BButton"),p=(0,i.up)("b-button-group"),g=(0,i.up)("ol-view"),b=(0,i.up)("ol-source-osm"),k=(0,i.up)("ol-tile-layer"),U=(0,i.up)("ol-style-fill"),S=(0,i.up)("ol-style-icon"),O=(0,i.up)("ol-style-text"),B=(0,i.up)("ol-style"),j=(0,i.up)("ol-interaction-select"),E=(0,i.up)("ol-context-menu-control"),M=(0,i.up)("ol-geom-point"),R=(0,i.up)("ol-feature"),x=(0,i.up)("ol-source-vector"),H=(0,i.up)("ol-vector-layer"),F=(0,i.up)("ol-geolocation"),K=(0,i.up)("ol-geom-multi-point"),z=(0,i.up)("ol-style-stroke"),J=(0,i.up)("ol-style-circle"),Z=(0,i.up)("ol-map");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(p,{size:"sm",class:"map-toolbar"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{onClick:o[0]||(o[0]=e=>_.value=!_.value),variant:1==_.value?"warning":"success"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,f.zw)(1==_.value?"don't follow me":"follow me"),1)])),_:1},8,["variant"])])),_:1}),(0,i.Wm)(Z,{loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,style:{height:"400px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{ref_key:"view",ref:m,center:l.value,rotation:a.value,zoom:n.value,projection:s.value},null,8,["center","rotation","zoom","projection"]),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b)])),_:1}),(0,i.Wm)(j,{onSelect:V,condition:(0,v.SU)(I),features:t.selectedFeatures},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{overrideStyleFunction:C},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{color:d.value},null,8,["color"]),(0,i.Wm)(S,{src:(0,v.SU)(w),scale:.1},null,8,["src"]),(0,i.Wm)(O,{color:"white",text:"Hellooooo"})])),_:1})])),_:1},8,["condition","features"]),(0,i.Wm)(E,{items:P.value},null,8,["items"]),(0,i.Wm)(F,{projection:s.value,"onChange:position":W},{default:(0,i.w5)((()=>[(0,i._)("template",null,[(0,i.Wm)(H,{zIndex:2},{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(R,{ref:"positionFeature"},{default:(0,i.w5)((()=>[(0,i.Wm)(M,{coordinates:y.value},null,8,["coordinates"]),(0,i.Wm)(B,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{src:(0,v.SU)(A),scale:.1},null,8,["src"])])),_:1})])),_:1},512)])),_:1})])),_:1})])])),_:1},8,["projection"]),(0,i.Wm)(H,null,{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.users,((e,t)=>((0,i.wg)(),(0,i.j4)(R,{key:t},{default:(0,i.w5)((()=>[void 0!=e.position?((0,i.wg)(),(0,i.j4)(K,{key:0,coordinates:e.position.coordinates},null,8,["coordinates"])):(0,i.kq)("",!0),(0,i.Wm)(B,null,{default:(0,i.w5)((()=>[(0,i.Wm)(J,{radius:c.value},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{color:d.value},null,8,["color"]),(0,i.Wm)(z,{color:e.profile.color,width:u.value},null,8,["color","width"]),(0,i.Wm)(O,{text:e.profile.name},null,8,["text"])])),_:2},1032,["radius"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,i.Wm)(H,null,{default:(0,i.w5)((()=>[(0,i.Wm)(x,{ref_key:"rdvMarkers",ref:D},null,512),(0,i.Wm)(B,{overrideStyleFunction:C},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{color:d.value},null,8,["color"]),(0,i.Wm)(S,{src:(0,v.SU)(h),scale:.05},null,8,["src"]),(0,i.Wm)(O,{text:"Hellooooo"})])),_:1})])),_:1})])),_:1}),(0,i.Wm)(T)],64)}}};const H=(0,s.Z)(x,[["__scopeId","data-v-1b99ffac"]]);var F=H;const K={class:"row"},z=(0,i._)("label",{class:"col-form-label col-2",for:"inline-form-input-name"},"Nom",-1),J={class:"col-8"},Z={class:"col-2"},Y={class:"row"},G=(0,i._)("label",{class:"col-form-label col-2",for:"inline-form-input-profile"},"Profil",-1),q={class:"col-8"},L={class:"col-2"},N={style:{"margin-bottom":"30px"}},Q=["onClick"],$={key:0,class:"row"},X=(0,i._)("label",{class:"col-form-label col-2",for:"inline-form-input-profile"},"intérêt",-1),ee={class:"col-8"},te={class:"col-2"};function oe(e,t,o,l,s,n){const a=(0,i.up)("BButton"),d=(0,i.up)("b-button-group"),u=(0,i.up)("b-button"),c=(0,i.up)("BFormInput"),p=(0,i.up)("BListGroupItem"),m=(0,i.up)("BListGroup"),v=(0,i.up)("BForm"),g=(0,i.up)("BModal");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(a,{onClick:t[0]||(t[0]=e=>s.showProfile=!s.showProfile),variant:"info"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Profil")])),_:1})])),_:1}),(0,i.Uk)("    "),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{onClick:t[1]||(t[1]=e=>n.setView("users"))},{default:(0,i.w5)((()=>[(0,i.Uk)("Users")])),_:1}),(0,i.Wm)(u,{onClick:t[2]||(t[2]=e=>n.setView("rdv"))},{default:(0,i.w5)((()=>[(0,i.Uk)("Rdv")])),_:1}),(0,i.Wm)(u,{disabled:""},{default:(0,i.w5)((()=>[(0,i.Uk)("Calendar")])),_:1})])),_:1}),(0,i.Wm)(g,{modelValue:s.showProfile,"onUpdate:modelValue":t[7]||(t[7]=e=>s.showProfile=e),onOk:n.updateUser},{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i._)("div",K,[z,(0,i._)("div",J,[(0,i.Wm)(c,{id:"inline-form-input-name",class:"mb-2 me-sm-2 mb-sm-0",modelValue:s.user.name,"onUpdate:modelValue":t[3]||(t[3]=e=>s.user.name=e),placeholder:"username"},null,8,["modelValue"])]),(0,i._)("div",Z,[(0,i.Wm)(c,{modelValue:s.user.color,"onUpdate:modelValue":t[4]||(t[4]=e=>s.user.color=e),type:"color"},null,8,["modelValue"])])]),(0,i._)("div",Y,[G,(0,i._)("div",q,[(0,i.Wm)(c,{id:"inline-form-input-profile",modelValue:s.profile_name,"onUpdate:modelValue":t[5]||(t[5]=e=>s.profile_name=e),placeholder:"profile name",onKeyup:(0,r.D2)(n.addProfile,["enter"])},null,8,["modelValue","onKeyup"])]),(0,i._)("div",L,[(0,i.Wm)(a,{onClick:n.addProfile},{default:(0,i.w5)((()=>[(0,i.Uk)(" +")])),_:1},8,["onClick"])])]),(0,i.Uk)(" "+(0,f.zw)(n.profile)+" ",1),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.profiles,(e=>((0,i.wg)(),(0,i.j4)(p,{key:e.id,href:"#",active:n.profile==e.id,onClick:t=>n.changeProfile(e.id)},{default:(0,i.w5)((()=>[(0,i._)("h6",N,(0,f.zw)(e.name),1),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.interests,(t=>((0,i.wg)(),(0,i.iD)("button",{key:t,type:"button",class:"btn btn-dark position-relative",style:{"margin-right":"'5px'"}},[(0,i.Uk)((0,f.zw)(t)+" ",1),(0,i._)("span",{class:"position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle",onClick:o=>n.remove_interest({profil:e.id,interest:t})}," X ",8,Q)])))),128)),e.interests.length<5?((0,i.wg)(),(0,i.iD)("div",$,[X,(0,i._)("div",ee,[(0,i.Wm)(c,{modelValue:s.new_interest,"onUpdate:modelValue":t[6]||(t[6]=e=>s.new_interest=e),value:s.new_interest,placeholder:"nouvel interêt",onKeyup:(0,r.D2)((t=>n.addInteret({profil:e.id})),["enter"])},null,8,["modelValue","value","onKeyup"])]),(0,i._)("div",te,[(0,i.Wm)(a,{onClick:t=>n.addInteret({profil:e.id})},{default:(0,i.w5)((()=>[(0,i.Uk)(" +")])),_:2},1032,["onClick"])])])):(0,i.kq)("",!0)])),_:2},1032,["active","onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","onOk"])])}o(7658);var re=o(5288),ie=o(9373),le=o(2213),se=o(114);const ne={rdvs:{}},ae=(0,re.wI)(ne),de=(0,re.ms)(ae),ue=new se.GL(de),ce=new ie.x$("rdv",de,{awareness:ue,signaling:["wss://noosld-webrtc.glitch.me"]}),pe=new le.VU("wss://yjs-leveldb.glitch.me/rdv","rdv",de,{awareness:ue});ce.on("status",(e=>{console.log("** webrtcProvider in y_store",e.status)})),pe.on("status",(e=>{console.log("## websocketProvider in y_store",e.status)}));var me={name:"ProfileView",data(){return{showProfile:!1,user:{name:"user_"+Date.now(),color:"#ffb61e",clientID:ue.clientID},profile_name:"",interests:"",new_interest:""}},created(){let e=JSON.parse(localStorage.getItem("rdv_user"));if(console.log("localstorage user",e),e&&e.name&&e.color){this.user=e;let t=JSON.parse(localStorage.getItem("rdv_user_interests"));void 0!=t&&(console.log("from localstorage",t.profiles,t.profile),this.$store.commit("core/setProfiles",t.profiles),this.$store.commit("core/setProfile",t.profile))}ue.setLocalStateField("profile",this.user),this.updateInterests()},methods:{addInteret(e){if(this.new_interest.trim().length>0){console.log(this.new_interest,e);let t=this.profiles.find((t=>t.id==e.profil));t.interests.push(this.new_interest),this.new_interest="",console.log(t)}else alert("Ajoutez un centre d'intérêts")},remove_interest(e){console.log("remove",e.interest);let t=this.profiles.find((t=>t.id==e.profil));t.interests=t.interests.filter((t=>t!=e.interest))},onInputEventHandler(e){console.log(e),console.log(this.interests)},addProfile(){if(this.profile_name.trim().length>0){let e={name:this.profile_name,interests:[]};this.$store.commit("core/addProfile",e),this.profile_name=""}else alert("ajoutez un nom de profil")},setView(e){this.$store.commit("core/setView",e)},updateUser(){console.log("User",this.user),ue.setLocalStateField("profile",this.user),localStorage.setItem("rdv_user",JSON.stringify(this.user)),this.updateInterests()},changeProfile(e){console.log(e),this.$store.commit("core/setProfile",e)},updateInterests(){console.log("update interests"),ue.setLocalStateField("interests",{like:this.profiles.find((e=>e.id==this.profile))}),localStorage.setItem("rdv_user_interests",JSON.stringify({profiles:this.profiles,profile:this.profile}))}},watch:{profiles(){this.updateInterests()},profile(){this.updateInterests()}},computed:{profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile}}};const fe=(0,s.Z)(me,[["render",oe]]);var ve=fe;const ge={class:"row"},he={class:"col"},we={key:0,class:"col"},Ae={class:"col"},be={key:0},ke={key:1};function ye(e,t,o,r,l,s){const n=(0,i.up)("BBadge"),a=(0,i.up)("BListGroupItem"),d=(0,i.up)("BListGroup");return(0,i.wg)(),(0,i.iD)("div",null,[l.users.length>0?((0,i.wg)(),(0,i.j4)(d,{key:0,class:"scroll_list"},{default:(0,i.w5)((()=>[(0,i._)("div",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.users,(e=>((0,i.wg)(),(0,i.j4)(a,{key:e.profile.clientID,href:"#",onClick:t=>s.userClicked(e)},{default:(0,i.w5)((()=>[(0,i._)("h2",null,(0,f.zw)(e.profile.name),1),(0,i._)("div",ge,[(0,i._)("div",he,[(0,i._)("div",{class:"user_color",style:(0,f.j5)("width:20px;height:20px;background-color:"+e.profile.color)},null,4)]),void 0!=e.distance?((0,i.wg)(),(0,i.iD)("div",we,(0,f.zw)(e.distance>1?e.distance+" km":Math.floor(1e3*e.distance)+" m"),1)):(0,i.kq)("",!0),(0,i._)("div",Ae,[void 0!=e.interests&&void 0!=e.interests.like&&void 0!=e.interests.like.interests&&s.profiles.length>0?((0,i.wg)(),(0,i.iD)("div",be,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.interests.like.interests,(e=>((0,i.wg)(),(0,i.j4)(n,{key:e,variant:s.getInterestVariant(e)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,f.zw)(e),1)])),_:2},1032,["variant"])))),128))])):(0,i.kq)("",!0)])])])),_:2},1032,["onClick"])))),128))])])),_:1})):((0,i.wg)(),(0,i.iD)("div",ke," Recherche des voisins "))])}var _e={name:"UsersView",data(){return{users:[],awareness:ue,updating:null}},created(){ue.on("change",(e=>{console.log("--changes",e),this.updateUsers(Array.from(ue.getStates().values()).filter((e=>void 0!=e.profile&&e.profile.clientID!=ue.clientID)))}))},methods:{userClicked(e){console.log(e),void 0!=e.position&&this.$store.commit("core/centerToPoint",e.position.coordinates)},updateUsers(e){(null==this.updating||Date.now()-this.updating>1e4)&&(console.log("UPDATE USERS"),this.users=this.withDistances(e).sort((function(e,t){return e.distance-t.distance})),this.$store.commit("core/setUsers",this.users),this.updating=Date.now())},withDistances(e){let t=e.map((e=>{var t=Object.assign({},e);if(void 0!=e.position&&void 0!=this.myPosition){const o=this.$getDistanceFromLatLonInKm(this.myPosition[0],this.myPosition[1],e.position.coordinates[0],e.position.coordinates[1]).toFixed(3);t.distance=o}return t}));return t},getInterestVariant(e){let t=this.profiles.find((e=>e.id==this.profile));return void 0!=t&&t.interests.includes(e)?"info":"light"}},computed:{myPosition(){return this.$store.state.core.myPosition},profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile}}};const De=(0,s.Z)(_e,[["render",ye],["__scopeId","data-v-549a9838"]]);var Pe=De;const We=(0,i._)("br",null,null,-1),Ue={key:0},Se=(0,i._)("br",null,null,-1);function Ie(e,t,o,r,l,s){const n=(0,i.up)("AdresseView"),a=(0,i.up)("BListGroupItem"),d=(0,i.up)("BListGroup");return(0,i.wg)(),(0,i.j4)(d,{class:"scroll_list"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.rdvs,(e=>((0,i.wg)(),(0,i.j4)(a,{key:e.uuid,button:"",onClick:t=>s.rdvSelected(e)},{default:(0,i.w5)((()=>[(0,i._)("h4",null,(0,f.zw)(e.title),1),(0,i._)("small",null,(0,f.zw)(new Date(e.start).toLocaleString())+" -> "+(0,f.zw)(new Date(e.end).toLocaleString()),1),We,(0,i.Uk)(" "+(0,f.zw)(e.description)+" ",1),void 0!=e.distance?((0,i.wg)(),(0,i.iD)("span",Ue,[Se,(0,i.Uk)((0,f.zw)(e.distance>1?e.distance+" km":Math.floor(1e3*e.distance)+" m"),1)])):(0,i.kq)("",!0),(0,i.Wm)(n,{coordinates:e.coordinates},null,8,["coordinates"])])),_:2},1032,["onClick"])))),128))])),_:1})}const Ve={key:1};function Ce(e,t,o,l,s,n){return 0==s.adresseShow?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:t[0]||(t[0]=(0,r.iM)(((...e)=>n.showAdresse&&n.showAdresse(...e)),["stop"]))},"adresse")):((0,i.wg)(),(0,i.iD)("div",Ve,[(0,i.Uk)((0,f.zw)(s.adresse)+" ",1),(0,i._)("button",{onClick:t[1]||(t[1]=(0,r.iM)((e=>s.adresseShow=!1),["stop"]))},"cacher")]))}var Oe={name:"AdresseView",props:["coordinates"],data(){return{adresse:null,adresseShow:!1}},methods:{async showAdresse(){this.adresseShow=!0;let e=await this.adress(this.coordinates);this.adresse=e.display_name},async adress([e,t]){let o="https://nominatim.openstreetmap.org/reverse?lat="+t+"&lon="+e+"&format=json";console.log(o);let r=await fetch(o);return r.json()}},computed:{}};const Be=(0,s.Z)(Oe,[["render",Ce]]);var je=Be,Ee={name:"RdvView",components:{AdresseView:je},methods:{rdvSelected(e){this.$store.commit("core/centerToPoint",e.coordinates)},withDistances(e){let t=e.map((e=>{var t=Object.assign({},e);if(void 0!=e.coordinates&&void 0!=this.myPosition){const o=this.$getDistanceFromLatLonInKm(this.myPosition[0],this.myPosition[1],e.coordinates[0],e.coordinates[1]).toFixed(3);t.distance=o}return t}));return t.sort((function(e,t){return e.distance-t.distance}))}},computed:{rdvs(){return console.log("rdvs",this.rdvs),this.withDistances(this.$store.state.core.rdvs)},myPosition(){return this.$store.state.core.myPosition}}};const Me=(0,s.Z)(Ee,[["render",Ie]]);var Re=Me;function Te(e,t,o,r,l,s){return(0,i.wg)(),(0,i.iD)("div")}var xe=o(6866);(0,re.QB)(xe);var He={name:"RdvUpdater",created(){console.log("RDV CREATED !!!!!!!!!!!!!!!!!!!!!",ue),(0,re.QT)(ae.rdvs,this.rdvsUpdate)},methods:{rdvsUpdate(){let e=[];for(let[t,o]of Object.entries(ae.rdvs)){let r=Date.parse(o.end),i=Date.now();if(console.log(o.title,o.end,r,i,r-i),r<i)return console.log("DELETE old rdv",t),void delete ae.rdvs[t];e.push(o)}this.$store.commit("core/setRdvs",e)},rdvsUpdate1(){let e=[];for(let[t,o]of Object.entries(ae.rdvs))if(t!=ue.clientID){console.log("coordin",t,o.coordinates[0],o.coordinates[1],o.title),console.log("dates",t,o.end_date,o.end_time);let r=o.end_date+"T"+o.end_time;console.log("iso",r);let i=new Date(r),l=Date.now();console.log(l,i);let s=i.getTime()-l;if(s<0)return console.log("diff delete",s),void delete ae.rdvs[t];void 0!=o.end_date&&void 0!=o.end_time?e.push(o):(console.log(t,"no end_date"),delete ae.rdvs[t])}this.$store.commit("core/setRdvs",e)}}};const Fe=(0,s.Z)(He,[["render",Te]]);var Ke=Fe,ze={name:"MapView",components:{WorldMap:F,ProfileView:ve,UsersView:Pe,RdvView:Re,RdvUpdater:Ke},computed:{view(){return this.$store.state.core.view},users(){return this.$store.state.core.users},rdvs(){return this.$store.state.core.rdvs}}};const Je=(0,s.Z)(ze,[["render",m]]);var Ze=Je;const Ye=[{path:"/",name:"home",component:Ze},{path:"/about",name:"about",component:()=>o.e(443).then(o.bind(o,2995))}],Ge=(0,c.p7)({history:(0,c.PO)("/rdv/"),routes:Ye});var qe=Ge,Le=o(3029);const Ne=()=>({level:0,profiles:[],profile:null,myPosition:[],users:[],centerPoint:null,view:"users",rdvs:[],rdv:null,positionUpdated:null}),Qe={updateMyPosition(e,t){console.log("position update",t),e.myPosition=t,console.log("delay ",Date.now()-e.positionUpdated),Date.now()-e.positionUpdated>1e4&&(e.positionUpdated=Date.now(),ue.setLocalStateField("position",{coordinates:t,updated:e.positionUpdated}))},setUsers(e,t){e.users=t},setRdv(e,t){void 0==t.uuid&&(t.uuid=(0,Le.Z)()),void 0==t.author&&(t.author=ue.clientID),e.rdv=t},setProfiles(e,t){e.profiles=t},setProfile(e,t){e.profile=t},centerToPoint(e,t){e.centerPoint=t},addProfile(e,t){t.id=(0,Le.Z)(),e.profiles.push(t)},setView(e,t){e.view=t},setRdvs(e,t){e.rdvs=t}},$e={increment(e,t){e.commit("increment",t)},updateYstoreRdvs(e,t){ae.rdvs[t.uuid]=t}};var Xe={namespaced:!0,state:Ne,actions:$e,mutations:Qe},et=(0,g.MT)({state:{},getters:{},mutations:{},actions:{},modules:{core:Xe}}),tt={install(e,t){console.log(e,t);let o=t.store;console.log(o),e.config.globalProperties.$getDistanceFromLatLonInKm=(t,o,r,i)=>{var l=6371,s=e.config.globalProperties.$deg2rad(r-t),n=e.config.globalProperties.$deg2rad(i-o),a=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e.config.globalProperties.$deg2rad(t))*Math.cos(e.config.globalProperties.$deg2rad(r))*Math.sin(n/2)*Math.sin(n/2),d=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),u=l*d;return u},e.config.globalProperties.$deg2rad=e=>e*(Math.PI/180)}},ot=o(2026),rt=o(8784);(0,r.ri)(d).use(et).use(qe).use(ot.ZP).use(ae).use(tt,{store:et}).use(rt.ZP).mount("#app")}},t={};function o(r){var i=t[r];if(void 0!==i)return i.exports;var l=t[r]={exports:{}};return e[r].call(l.exports,l,l.exports,o),l.exports}o.m=e,function(){var e=[];o.O=function(t,r,i,l){if(!r){var s=1/0;for(u=0;u<e.length;u++){r=e[u][0],i=e[u][1],l=e[u][2];for(var n=!0,a=0;a<r.length;a++)(!1&l||s>=l)&&Object.keys(o.O).every((function(e){return o.O[e](r[a])}))?r.splice(a--,1):(n=!1,l<s&&(s=l));if(n){e.splice(u--,1);var d=i();void 0!==d&&(t=d)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[r,i,l]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,r){return o.f[r](e,t),t}),[]))}}(),function(){o.u=function(e){return"js/about.dfe66140.js"}}(),function(){o.miniCssF=function(e){}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="rdv:";o.l=function(r,i,l,s){if(e[r])e[r].push(i);else{var n,a;if(void 0!==l)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==r||c.getAttribute("data-webpack")==t+l){n=c;break}}n||(a=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,o.nc&&n.setAttribute("nonce",o.nc),n.setAttribute("data-webpack",t+l),n.src=r),e[r]=[i];var p=function(t,o){n.onerror=n.onload=null,clearTimeout(m);var i=e[r];if(delete e[r],n.parentNode&&n.parentNode.removeChild(n),i&&i.forEach((function(e){return e(o)})),t)return t(o)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=p.bind(null,n.onerror),n.onload=p.bind(null,n.onload),a&&document.head.appendChild(n)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/rdv/"}(),function(){var e={143:0};o.f.j=function(t,r){var i=o.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var l=new Promise((function(o,r){i=e[t]=[o,r]}));r.push(i[2]=l);var s=o.p+o.u(t),n=new Error,a=function(r){if(o.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var l=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;n.message="Loading chunk "+t+" failed.\n("+l+": "+s+")",n.name="ChunkLoadError",n.type=l,n.request=s,i[1](n)}};o.l(s,a,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,l,s=r[0],n=r[1],a=r[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(i in n)o.o(n,i)&&(o.m[i]=n[i]);if(a)var u=a(o)}for(t&&t(r);d<s.length;d++)l=s[d],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(u)},r=self["webpackChunkrdv"]=self["webpackChunkrdv"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=o.O(void 0,[998],(function(){return o(2669)}));r=o.O(r)})();
//# sourceMappingURL=app.c6c92d75.js.map