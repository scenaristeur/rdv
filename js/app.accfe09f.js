(function(){var e={3544:function(e,t,o){"use strict";var r=o(9242),i=o(3396);function n(e,t){const o=(0,i.up)("router-view");return(0,i.wg)(),(0,i.j4)(o)}var s=o(89);const l={},a=(0,s.Z)(l,[["render",n]]);var d=a,c=o(5431);(0,c.z)("/rdv/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh."),alert("This app has been updated, please close the app & re-open")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var u=o(2483);const m={class:"home"};function p(e,t,o,r,n,s){const l=(0,i.up)("MapComponent"),a=(0,i.up)("ProfileView"),d=(0,i.up)("UsersView"),c=(0,i.up)("RdvView"),u=(0,i.up)("RdvUpdater");return(0,i.wg)(),(0,i.iD)("div",m,[(0,i.Wm)(l),(0,i.Wm)(a),"users"==s.view?((0,i.wg)(),(0,i.j4)(d,{key:0})):(0,i.kq)("",!0),"rdv"==s.view?((0,i.wg)(),(0,i.j4)(c,{key:1})):(0,i.kq)("",!0),(0,i.Wm)(u)])}const f={for:"datePicker"},h=(0,i._)("code",null,"When ?",-1),w={key:0},v=(0,i._)("i",null,"7 days max",-1),g=[v],k={role:"group"},_=(0,i._)("label",{for:"input-live"},[(0,i._)("code",null,"Title:")],-1),y=(0,i._)("label",{for:"textarea"},[(0,i._)("code",null,"Description:")],-1),b=(0,i._)("label",{for:"color"},[(0,i._)("code",null,"Color:")],-1),A=(0,i._)("label",{for:"password"},[(0,i._)("code",null,"Password:")],-1);function W(e,t,o,r,n,s){const l=(0,i.up)("ol-view"),a=(0,i.up)("ol-source-osm"),d=(0,i.up)("ol-tile-layer"),c=(0,i.up)("ol-style-fill"),u=(0,i.up)("ol-style-stroke"),m=(0,i.up)("ol-style-text"),p=(0,i.up)("ol-style-circle"),v=(0,i.up)("ol-style"),W=(0,i.up)("ol-interaction-select"),P=(0,i.up)("ol-geom-point"),D=(0,i.up)("ol-style-icon"),C=(0,i.up)("ol-feature"),I=(0,i.up)("ol-source-vector"),S=(0,i.up)("ol-vector-layer"),M=(0,i.up)("ol-geolocation"),U=(0,i.up)("ol-context-menu-control"),V=(0,i.up)("ol-geom-multi-point"),O=(0,i.up)("ol-map"),T=(0,i.up)("VueDatePicker"),x=(0,i.up)("b-form-input"),j=(0,i.up)("b-form-invalid-feedback"),B=(0,i.up)("b-form-text"),E=(0,i.up)("b-form-textarea"),L=(0,i.up)("b-col"),z=(0,i.up)("b-row"),$=(0,i.up)("BModal");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(O,{loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,style:{height:"400px"},ref:"map"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{ref:"view",center:n.center,rotation:n.rotation,zoom:n.zoom,projection:n.projection},null,8,["center","rotation","zoom","projection"]),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(a)])),_:1}),(0,i.Wm)(W,{onSelect:s.featureSelected},{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{radius:2*n.radius},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"green"}),(0,i.Wm)(u,{color:"red",width:n.strokeWidth},null,8,["width"]),(0,i.Wm)(m,{text:"selected"})])),_:1},8,["radius"])])),_:1})])),_:1},8,["onSelect"]),(0,i.Wm)(M,{projection:n.projection,"onChange:position":s.geoLocChange},{default:(0,i.w5)((()=>[(0,i._)("template",null,[(0,i.Wm)(S,{zIndex:2},{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[(0,i.Wm)(C,{ref:"positionFeature"},{default:(0,i.w5)((()=>[(0,i.Wm)(P,{coordinates:n.position},null,8,["coordinates"]),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,{src:n.hereIcon,scale:.1},null,8,["src"])])),_:1})])),_:1},512)])),_:1})])),_:1})])])),_:1},8,["projection","onChange:position"]),(0,i.Wm)(U,{items:n.contextMenuItems},null,8,["items"]),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,{ref:"markers"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,{src:n.marker,scale:.05},null,8,["src"])])),_:1})])),_:1},512)])),_:1}),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.users,((e,t)=>((0,i.wg)(),(0,i.j4)(C,{key:t},{default:(0,i.w5)((()=>[void 0!=e.position?((0,i.wg)(),(0,i.j4)(V,{key:0,coordinates:e.position.coordinates},null,8,["coordinates"])):(0,i.kq)("",!0),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{radius:n.radius},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:n.fillColor},null,8,["color"]),(0,i.Wm)(u,{color:e.profile.color,width:n.strokeWidth},null,8,["color","width"]),(0,i.Wm)(m,{text:e.profile.name},null,8,["text"])])),_:2},1032,["radius"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.rdvs,(e=>((0,i.wg)(),(0,i.j4)(C,{key:e.uuid},{default:(0,i.w5)((()=>[void 0!=e.coordinates?((0,i.wg)(),(0,i.j4)(V,{key:0,coordinates:e.coordinates},null,8,["coordinates"])):(0,i.kq)("",!0),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,{src:n.marker,scale:.05},null,8,["src"]),(0,i.Wm)(m,{text:e.title},null,8,["text"]),(0,i.Wm)(u,{color:e.color||"yellow",width:n.strokeWidth},null,8,["color","width"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},512),(0,i.Wm)($,{modelValue:n.modal,"onUpdate:modelValue":t[5]||(t[5]=e=>n.modal=e),onOk:s.onAddRdv,size:"lg"},{default:(0,i.w5)((()=>[(0,i._)("label",f,[h,(0,i.Uk)(),1==n.edit?((0,i.wg)(),(0,i.iD)("small",w,g)):(0,i.kq)("",!0)]),(0,i.Wm)(T,{id:"datePicker",modelValue:n.date,"onUpdate:modelValue":t[0]||(t[0]=e=>n.date=e),range:"","partial-range":"","max-range":"7","format-locale":n.fr,format:"Pp","min-date":new Date,"max-date":new Date((new Date).setDate((new Date).getDate()+15)),disabled:!n.edit},null,8,["modelValue","format-locale","min-date","max-date","disabled"]),(0,i._)("div",k,[_,(0,i.Wm)(x,{id:"input-live",modelValue:n.rdv.title,"onUpdate:modelValue":t[1]||(t[1]=e=>n.rdv.title=e),state:n.stateTitle,onInput:s.titleState,disabled:!n.edit,"aria-describedby":"input-live-help input-live-feedback",placeholder:"Title",trim:""},null,8,["modelValue","state","onInput","disabled"]),(0,i.Wm)(j,{id:"input-live-feedback"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Enter at least 3 and less than 50 letters ")])),_:1}),(0,i.Wm)(B,{id:"input-live-help"},{default:(0,i.w5)((()=>[(0,i.Uk)("A cool title for your event.")])),_:1})]),y,(0,i.Wm)(E,{id:"textarea",modelValue:n.rdv.description,"onUpdate:modelValue":t[2]||(t[2]=e=>n.rdv.description=e),placeholder:"Description",rows:"3","max-rows":"6",disabled:!n.edit},null,8,["modelValue","disabled"]),(0,i.Wm)(z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(L,null,{default:(0,i.w5)((()=>[b,(0,i.Wm)(x,{id:"color",modelValue:n.rdv.color,"onUpdate:modelValue":t[3]||(t[3]=e=>n.rdv.color=e),disabled:!n.edit,type:"color"},null,8,["modelValue","disabled"])])),_:1}),(0,i.Wm)(L,null,{default:(0,i.w5)((()=>[A,(0,i.Wm)(x,{id:"password",modelValue:n.password,"onUpdate:modelValue":t[4]||(t[4]=e=>n.password=e),placeholder:"password protect",type:"password"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","onOk"])])}var P=o(7676),D=o(5469),C=o(7548),I=o(2108),S=o(8014),M=o(9002),U=o.n(M),V=o(1586),O=o.n(V),T=o(1508),x=o(2949),j=o(1330),B=o(3029),E={name:"MapComponent",components:{VueDatePicker:I.Z},data(){return{initialisation:!0,center:[47.41322,-1.219482],rotation:0,zoom:14,projection:"EPSG:4326",position:[],hereIcon:D,marker:P,radius:10,strokeWidth:4,strokeColor:"red",fillColor:"white",coordinates:[],contextMenuItems:null,rdv:{},edit:!1,modal:!1,inputFields:[{id:"title",name:"Title",type:"text"},{id:"desc",name:"Description",type:"text"},{id:"color",name:"Color",type:"color"},{id:"start_date",name:"Start Date",type:"date",min:(new Date).toISOString().split("T")[0]},{id:"start_time",name:"Start Time",type:"time"},{id:"end_date",name:"End Date",type:"date",min:(new Date).toISOString().split("T")[0]},{id:"end_time",name:"End Time",type:"time"}],fr:S.Z,stateTitle:!1,date:null,password:null}},created(){this.initContextMenu()},methods:{titleState(){this.stateTitle=1!=this.edit||this.rdv.title.length>2&&this.rdv.title.length<51},initContextMenu(){let e=this;this.contextMenuItems=[{text:"Center map here",classname:"some-style-class",callback:t=>{e.$refs.view.setCenter(t.coordinate)}},{text:"Add a rdv",classname:"some-style-class",icon:C,callback:t=>{e.rdv={uuid:(0,B.Z)(),author:j.kW.clientID,coordinates:t.coordinate,start_date:(new Date).toISOString().split("T")[0],end_date:(new Date).toISOString().split("T")[0],start_time:"00:00",end_time:"23:59"},e.edit=!0,e.modal=!0}},{text:"Add a Marker",classname:"some-style-class",icon:P,callback:t=>{console.log(t);const o=new T.Z({geometry:new x.Z(t.coordinate)});console.log("new feature",o),e.$refs.markers.source.addFeature(o)}},"-"]},onAddRdv(){console.log(this.date),null==this.date[1]&&(this.date[1]=this.date[0]);let e=this.date[0].toISOString().split("T"),t=this.date[1].toISOString().split("T");this.rdv.start_date=e[0],this.rdv.start_time=e[1],this.rdv.end_date=t[0],this.rdv.end_time=t[1],this.rdv.password=O().stringify(U()(this.password)),this.password="",console.log(this.rdv),this.rdv.updated=Date.now();const o=new T.Z({geometry:new x.Z(this.rdv.coordinates),data:this.rdv});1==this.edit&&(this.$refs.markers.source.addFeature(o),j.h.rdvs[this.rdv.uuid]=this.rdv)},featureSelected(e){if(console.log("feature selected",e.selected,e.target),e.selected.length>0){let t=e.selected[0].get("uuid");console.log("selected",e.selected[0],t)}},geoLocChange(e){this.position=e.target.getPosition(),this.$store.commit("core/updateMyPosition",this.position),1==this.centerMe&&this.$refs.view.setCenter(this.position),j.kW.setLocalStateField("position",{coordinates:this.position,updated:Date.now()})},userMapClicked(e){console.log(e)}},watch:{centerMe(){1==this.centerMe&&(console.log("center me",this.centerMe),this.$refs.view.setCenter(this.position))},centerPoint(){console.log(this.centerPoint),this.$refs.view.setCenter(this.centerPoint)}},computed:{users(){return this.$store.state.core.users},rdvs(){return this.$store.state.core.rdvs},centerMe(){return this.$store.state.core.centerMe},centerPoint(){return this.$store.state.core.centerPoint}}};const L=(0,s.Z)(E,[["render",W]]);var z=L,$=o(7139);const K={class:"row"},F=(0,i._)("label",{class:"col-form-label col-2",for:"inline-form-input-name"},"Nom",-1),Z={class:"col-8"},q={class:"col-2"},N={class:"row"},R=(0,i._)("label",{class:"col-form-label col-2",for:"inline-form-input-profile"},"Profil",-1),G={class:"col-8"},J={class:"col-2"},H={style:{"margin-bottom":"30px"}},Y=["onClick"],Q={key:0,class:"row"},X=(0,i._)("label",{class:"col-form-label col-2",for:"inline-form-input-profile"},"intérêt",-1),ee={class:"col-8"},te={class:"col-2"};function oe(e,t,o,n,s,l){const a=(0,i.up)("BButton"),d=(0,i.up)("b-button-group"),c=(0,i.up)("b-button"),u=(0,i.up)("BFormInput"),m=(0,i.up)("BListGroupItem"),p=(0,i.up)("BListGroup"),f=(0,i.up)("BForm"),h=(0,i.up)("BModal");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(a,{onClick:t[0]||(t[0]=e=>s.showProfile=!s.showProfile),variant:"info"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Profil")])),_:1}),(0,i.Wm)(a,{onClick:l.followMe,variant:1==l.centerMe?"outline-warning":"outline-success"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,$.zw)(1==l.centerMe?"don't follow me":"follow me"),1)])),_:1},8,["onClick","variant"])])),_:1}),(0,i.Uk)("    "),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{onClick:t[1]||(t[1]=e=>l.setView("users"))},{default:(0,i.w5)((()=>[(0,i.Uk)("Users")])),_:1}),(0,i.Wm)(c,{onClick:t[2]||(t[2]=e=>l.setView("rdv"))},{default:(0,i.w5)((()=>[(0,i.Uk)("Rdv")])),_:1})])),_:1}),(0,i.Wm)(h,{modelValue:s.showProfile,"onUpdate:modelValue":t[7]||(t[7]=e=>s.showProfile=e),onOk:l.updateUser},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i._)("div",K,[F,(0,i._)("div",Z,[(0,i.Wm)(u,{id:"inline-form-input-name",class:"mb-2 me-sm-2 mb-sm-0",modelValue:s.user.name,"onUpdate:modelValue":t[3]||(t[3]=e=>s.user.name=e),placeholder:"username"},null,8,["modelValue"])]),(0,i._)("div",q,[(0,i.Wm)(u,{modelValue:s.user.color,"onUpdate:modelValue":t[4]||(t[4]=e=>s.user.color=e),type:"color"},null,8,["modelValue"])])]),(0,i._)("div",N,[R,(0,i._)("div",G,[(0,i.Wm)(u,{id:"inline-form-input-profile",modelValue:s.profile_name,"onUpdate:modelValue":t[5]||(t[5]=e=>s.profile_name=e),placeholder:"profile name",onKeyup:(0,r.D2)(l.addProfile,["enter"])},null,8,["modelValue","onKeyup"])]),(0,i._)("div",J,[(0,i.Wm)(a,{onClick:l.addProfile},{default:(0,i.w5)((()=>[(0,i.Uk)(" +")])),_:1},8,["onClick"])])]),(0,i.Uk)(" "+(0,$.zw)(l.profile)+" ",1),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.profiles,(e=>((0,i.wg)(),(0,i.j4)(m,{key:e.id,href:"#",active:l.profile==e.id,onClick:t=>l.changeProfile(e.id)},{default:(0,i.w5)((()=>[(0,i._)("h6",H,(0,$.zw)(e.name),1),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.interests,(t=>((0,i.wg)(),(0,i.iD)("button",{key:t,type:"button",class:"btn btn-dark position-relative",style:{"margin-right":"'5px'"}},[(0,i.Uk)((0,$.zw)(t)+" ",1),(0,i._)("span",{class:"position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle",onClick:o=>l.remove_interest({profil:e.id,interest:t})}," X ",8,Y)])))),128)),e.interests.length<5?((0,i.wg)(),(0,i.iD)("div",Q,[X,(0,i._)("div",ee,[(0,i.Wm)(u,{modelValue:s.new_interest,"onUpdate:modelValue":t[6]||(t[6]=e=>s.new_interest=e),value:s.new_interest,placeholder:"nouvel interêt",onKeyup:(0,r.D2)((t=>l.addInteret({profil:e.id})),["enter"])},null,8,["modelValue","value","onKeyup"])]),(0,i._)("div",te,[(0,i.Wm)(a,{onClick:t=>l.addInteret({profil:e.id})},{default:(0,i.w5)((()=>[(0,i.Uk)(" +")])),_:2},1032,["onClick"])])])):(0,i.kq)("",!0)])),_:2},1032,["active","onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","onOk"])])}o(7658);var re={name:"ProfileView",data(){return{showProfile:!1,user:{name:"user_"+Date.now(),color:"#ffb61e",clientID:j.kW.clientID},profile_name:"",interests:"",new_interest:""}},created(){let e=JSON.parse(localStorage.getItem("rdv_user"));if(console.log("localstorage user",e),e&&e.name&&e.color){this.user=e;let t=JSON.parse(localStorage.getItem("rdv_user_interests"));void 0!=t&&(console.log("from localstorage",t.profiles,t.profile),this.$store.commit("core/setProfiles",t.profiles),this.$store.commit("core/setProfile",t.profile))}j.kW.setLocalStateField("profile",this.user),this.updateInterests()},methods:{addInteret(e){if(this.new_interest.trim().length>0){console.log(this.new_interest,e);let t=this.profiles.find((t=>t.id==e.profil));t.interests.push(this.new_interest),this.new_interest="",console.log(t)}else alert("Ajoutez un centre d'intérêts")},remove_interest(e){console.log("remove",e.interest);let t=this.profiles.find((t=>t.id==e.profil));t.interests=t.interests.filter((t=>t!=e.interest))},onInputEventHandler(e){console.log(e),console.log(this.interests)},addProfile(){if(this.profile_name.trim().length>0){let e={name:this.profile_name,interests:[]};this.$store.commit("core/addProfile",e),this.profile_name=""}else alert("ajoutez un nom de profil")},setView(e){console.log("add rdv"),this.$store.commit("core/setView",e)},updateUser(){console.log("User",this.user),j.kW.setLocalStateField("profile",this.user),localStorage.setItem("rdv_user",JSON.stringify(this.user)),this.updateInterests()},changeProfile(e){console.log(e),this.$store.commit("core/setProfile",e)},updateInterests(){console.log("update interests"),j.kW.setLocalStateField("interests",{like:this.profiles.find((e=>e.id==this.profile))}),localStorage.setItem("rdv_user_interests",JSON.stringify({profiles:this.profiles,profile:this.profile}))},followMe(){console.log(this.centerMe),this.$store.commit("core/centerMe",!this.centerMe)}},watch:{profiles(){this.updateInterests()},profile(){this.updateInterests()}},computed:{profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile},centerMe(){return this.$store.state.core.centerMe}}};const ie=(0,s.Z)(re,[["render",oe]]);var ne=ie;const se={class:"row"},le={class:"col"},ae={key:0,class:"col"},de={class:"col"},ce={key:0},ue={key:1};function me(e,t,o,r,n,s){const l=(0,i.up)("BBadge"),a=(0,i.up)("BListGroupItem"),d=(0,i.up)("BListGroup");return(0,i.wg)(),(0,i.iD)("div",null,[n.users.length>0?((0,i.wg)(),(0,i.j4)(d,{key:0,class:"users_list"},{default:(0,i.w5)((()=>[(0,i._)("div",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.users,(e=>((0,i.wg)(),(0,i.j4)(a,{key:e.profile.clientID,href:"#",onClick:t=>s.userClicked(e)},{default:(0,i.w5)((()=>[(0,i._)("h2",null,(0,$.zw)(e.profile.name),1),(0,i._)("div",se,[(0,i._)("div",le,[(0,i._)("div",{class:"user_color",style:(0,$.j5)("width:20px;height:20px;background-color:"+e.profile.color)},null,4)]),void 0!=e.distance?((0,i.wg)(),(0,i.iD)("div",ae,(0,$.zw)(e.distance>1?e.distance+" km":Math.floor(1e3*e.distance)+" m"),1)):(0,i.kq)("",!0),(0,i._)("div",de,[void 0!=e.interests&&void 0!=e.interests.like&&void 0!=e.interests.like.interests&&s.profiles.length>0?((0,i.wg)(),(0,i.iD)("div",ce,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.interests.like.interests,(e=>((0,i.wg)(),(0,i.j4)(l,{key:e,variant:s.getInterestVariant(e)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,$.zw)(e),1)])),_:2},1032,["variant"])))),128))])):(0,i.kq)("",!0)])])])),_:2},1032,["onClick"])))),128))])])),_:1})):((0,i.wg)(),(0,i.iD)("div",ue," Recherche des voisins "))])}var pe={name:"UsersView",data(){return{users:[],awareness:j.kW}},created(){j.kW.on("change",(()=>{this.updateUsers(Array.from(j.kW.getStates().values()).filter((e=>void 0!=e.profile&&e.profile.clientID!=j.kW.clientID)))}))},methods:{userClicked(e){console.log(e),void 0!=e.position&&this.$store.commit("core/centerToPoint",e.position.coordinates)},updateUsers(e){console.log("UPDATE USERS",e),this.users=this.withDistances(e).sort((function(e,t){return e.distance-t.distance})),this.$store.commit("core/setUsers",this.users)},withDistances(e){let t=e.map((e=>{var t=Object.assign({},e);if(void 0!=e.position&&void 0!=this.myPosition){const o=this.$getDistanceFromLatLonInKm(this.myPosition[0],this.myPosition[1],e.position.coordinates[0],e.position.coordinates[1]).toFixed(3);t.distance=o}return t}));return t},getInterestVariant(e){let t=this.profiles.find((e=>e.id==this.profile));return void 0!=t&&t.interests.includes(e)?"info":"light"}},computed:{myPosition(){return this.$store.state.core.myPosition},profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile}}};const fe=(0,s.Z)(pe,[["render",me],["__scopeId","data-v-4e563f34"]]);var he=fe;const we=(0,i._)("br",null,null,-1),ve={key:0},ge=(0,i._)("br",null,null,-1);function ke(e,t,o,r,n,s){const l=(0,i.up)("AdresseView"),a=(0,i.up)("BListGroupItem"),d=(0,i.up)("BListGroup");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Uk)(" [[ display calendar]] "),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.rdvs,(e=>((0,i.wg)(),(0,i.j4)(a,{key:e.uuid,button:"",onClick:t=>s.rdvSelected(e)},{default:(0,i.w5)((()=>[(0,i._)("h4",null,(0,$.zw)(e.title),1),(0,i._)("small",null,(0,$.zw)(s.localeDateTime(e.start_date,e.start_time))+" -> "+(0,$.zw)(s.localeDateTime(e.end_date,e.end_time)),1),we,(0,i.Uk)(" "+(0,$.zw)(e.description)+" ",1),void 0!=e.distance?((0,i.wg)(),(0,i.iD)("span",ve,[ge,(0,i.Uk)((0,$.zw)(e.distance>1?e.distance+" km":Math.floor(1e3*e.distance)+" m"),1)])):(0,i.kq)("",!0),(0,i.Wm)(l,{coordinates:e.coordinates},null,8,["coordinates"])])),_:2},1032,["onClick"])))),128))])),_:1})])}const _e={key:1};function ye(e,t,o,n,s,l){return(0,i.wg)(),(0,i.iD)("div",null,[0==s.adresseShow?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:t[0]||(t[0]=(0,r.iM)(((...e)=>l.showAdresse&&l.showAdresse(...e)),["stop"]))},"adresse")):((0,i.wg)(),(0,i.iD)("div",_e,[(0,i.Uk)((0,$.zw)(s.adresse)+" ",1),(0,i._)("button",{onClick:t[1]||(t[1]=(0,r.iM)((e=>s.adresseShow=!1),["stop"]))},"cacher")]))])}var be={name:"AdresseView",props:["coordinates"],data(){return{adresse:null,adresseShow:!1}},methods:{async showAdresse(){this.adresseShow=!0;let e=await this.adress(this.coordinates);this.adresse=e.display_name},async adress([e,t]){let o="https://nominatim.openstreetmap.org/reverse?lat="+t+"&lon="+e+"&format=json";console.log(o);let r=await fetch(o);return r.json()}},computed:{}};const Ae=(0,s.Z)(be,[["render",ye]]);var We=Ae,Pe={name:"RdvView",components:{AdresseView:We},created(){},methods:{localeDateTime(e,t){return new Date(e+"T"+t).toLocaleString()},rdvSelected(e){this.$store.commit("core/centerToPoint",e.coordinates)},withDistances(e){let t=e.map((e=>{var t=Object.assign({},e);if(void 0!=e.coordinates&&void 0!=this.myPosition){const o=this.$getDistanceFromLatLonInKm(this.myPosition[0],this.myPosition[1],e.coordinates[0],e.coordinates[1]).toFixed(3);t.distance=o}return t}));return t.sort((function(e,t){return e.distance-t.distance}))}},computed:{rdvs(){return console.log("rdvs",this.rdvs),this.withDistances(this.$store.state.core.rdvs)},myPosition(){return this.$store.state.core.myPosition}}};const De=(0,s.Z)(Pe,[["render",ke]]);var Ce=De;function Ie(e,t,o,r,n,s){return(0,i.wg)(),(0,i.iD)("div")}var Se=o(6866),Me=o(5288);(0,Me.QB)(Se);var Ue={name:"RdvUpdater",created(){console.log("RDV CREATED !!!!!!!!!!!!!!!!!!!!!",j.kW),(0,Me.QT)(j.h.rdvs,this.rdvsUpdate)},methods:{rdvsUpdate(){let e=[];for(let[t,o]of Object.entries(j.h.rdvs))if(t!=j.kW.clientID){console.log("coordin",t,o.coordinates[0],o.coordinates[1],o.title),console.log("dates",t,o.end_date,o.end_time);let r=o.end_date+"T"+o.end_time;console.log("iso",r);let i=new Date(r),n=Date.now();console.log(n,i);let s=i.getTime()-n;if(s<0)return console.log("diff delete",s),void delete j.h.rdvs[t];void 0!=o.end_date&&void 0!=o.end_time?e.push(o):(console.log(t,"no end_date"),delete j.h.rdvs[t])}this.$store.commit("core/setRdvs",e)}}};const Ve=(0,s.Z)(Ue,[["render",Ie]]);var Oe=Ve,Te={name:"MapView",components:{MapComponent:z,ProfileView:ne,UsersView:he,RdvView:Ce,RdvUpdater:Oe},computed:{view(){return this.$store.state.core.view}}};const xe=(0,s.Z)(Te,[["render",p]]);var je=xe;const Be=[{path:"/",name:"home",component:je},{path:"/about",name:"about",component:()=>o.e(443).then(o.bind(o,5481))}],Ee=(0,u.p7)({history:(0,u.PO)("/rdv/"),routes:Be});var Le=Ee,ze=o(65);const $e=()=>({level:0,profiles:[],profile:null,myPosition:[],users:[],centerMe:!0,centerPoint:[],view:"users",rdvs:[]}),Ke={incrementLevel(e){e.level=e.level+1,console.log(e.level)},updateMyPosition(e,t){e.myPosition=t},setUsers(e,t){e.users=t},setProfiles(e,t){e.profiles=t},setProfile(e,t){e.profile=t},centerMe(e,t){e.centerMe=t},centerToPoint(e,t){e.centerPoint=t},addProfile(e,t){t.id=(0,B.Z)(),e.profiles.push(t)},setView(e,t){e.view=t},setRdvs(e,t){e.rdvs=t}},Fe={};var Ze={namespaced:!0,state:$e,actions:Fe,mutations:Ke},qe=(0,ze.MT)({state:{},getters:{},mutations:{},actions:{},modules:{core:Ze}}),Ne={install(e,t){console.log(e,t);let o=t.store;console.log(o),e.config.globalProperties.$getDistanceFromLatLonInKm=(t,o,r,i)=>{var n=6371,s=e.config.globalProperties.$deg2rad(r-t),l=e.config.globalProperties.$deg2rad(i-o),a=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e.config.globalProperties.$deg2rad(t))*Math.cos(e.config.globalProperties.$deg2rad(r))*Math.sin(l/2)*Math.sin(l/2),d=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),c=n*d;return c},e.config.globalProperties.$deg2rad=e=>e*(Math.PI/180)}},Re=o(2026),Ge=o(5523);(0,r.ri)(d).use(qe).use(Le).use(Re.ZP).use(j.h).use(Ne,{store:qe}).use(Ge.ZP).mount("#app")},1330:function(e,t,o){"use strict";o.d(t,{h:function(){return a},kW:function(){return c}});var r=o(5288),i=o(9373),n=o(2213),s=o(114);const l={rdvs:{}},a=(0,r.wI)(l),d=(0,r.ms)(a),c=new s.GL(d),u=new i.x$("rdv",d,{awareness:c,signaling:["wss://noosld-webrtc.glitch.me"]}),m=new n.VU("wss://yjs-leveldb.glitch.me/rdv","rdv",d,{awareness:c});u.on("status",(e=>{console.log("** webrtcProvider in y_store",e.status)})),m.on("status",(e=>{console.log("## websocketProvider in y_store",e.status)}))},5469:function(e,t,o){"use strict";e.exports=o.p+"img/here.b7fe6ce7.png"},7676:function(e,t,o){"use strict";e.exports=o.p+"img/marker.f58b9982.png"},7548:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADUElEQVR4Xu2a/ZFNQRDFz0aACBABIkAEiAARIAJEgAjYCBABIkAEiAARUD91p+rtrX13pme6+131bv+zW/VmpnvO9MeZvnOiI5eTI9+/NgA2DzhyBA4RAtclXZN0ZYb9d0lfJX3JPJMsAG5Jui/prqSLlQ0CxEdJp9PfUDyiAeCUX0sCgB4BiIeSACVEIgF4JOmlk9WPJb1yWuvMMlEAcOoPnA1+M3mD67IRALydYt3V0Gmxd5LueS7sDQAuj+tHCqFASLiIJwBkeE4/Q/ACvGFYPAH4dk5tHzZwzwJUhasei3sBQMIj8WUK5ZHEOCReAGSeftmwixd4AAC1/Ww8hvcTR4DoIOQPvOiOcZ0bo9TZAwAy8guD4Uuuaw2lJ6NkywMATvFmIwDPJT2rjOX3p43rfRqg2f9UZANwSdKvyua4LP38nwD4E2Bsq1cBJqB2i4cHtAJA4iPZtUgrAMNenAkAjQ6ydotQVaguLTK0h6HJk3WW04K91e729BDgFS2yiiQIG6Pb0yKAdbsy0HKbpGs0dO328AArD+ASAxeYVwOyP3zCsqFV8IAeJsjmAaKEA27f0i+cO88qmCBGsZHLLTHgOOaHx+3TIwTYU0YjZI6dS2PECwBL5vZygpaKUtXlBQCKiGnrba5q4J4BFlK1qMMTAHr/H3p3ZJxHKS1XaePUs8M9AWBlCynqNXyY/Owq9gYgwwvcTh8gvAGI9gLX048CILIiuGT+yBAoa0fwApe6P088ESGADng97PBCb6abzYP1Qblr3SSzuigAMMTzS5Hbl6AsDyh6PMiRG+k5zz0iPcAjFH5PFx531y9gRAMwGgphrp8JALp6qkJI1s/OAbv6aIryOqxFeC3W2hRtWW/vmIwQKMohSIBQK43EPZuvNU+HNp4dAkVfS2kMj/sMJrh0Okvf/lq+Hbqc/KE8YIkfhNb7fahl5oBdG6DK9A5KUiTpcZUOq/drA2CXJPE/CTJ98yg+lAeUAymlLvWB9KGToGsSG13s0B4wav/w/F4ASFitz2KGjWxcgJ6B+dlcLwCWdzyN9g8P6+oXbgB04r55gOEpWyfG5mmpIcAjBstDBvNuOibAJczP6HtzQId965yyAbDOc8mzavOAPKzXqekvWhOGQSnRji0AAAAASUVORK5CYII="},2480:function(){}},t={};function o(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,o),n.exports}o.m=e,function(){var e=[];o.O=function(t,r,i,n){if(!r){var s=1/0;for(c=0;c<e.length;c++){r=e[c][0],i=e[c][1],n=e[c][2];for(var l=!0,a=0;a<r.length;a++)(!1&n||s>=n)&&Object.keys(o.O).every((function(e){return o.O[e](r[a])}))?r.splice(a--,1):(l=!1,n<s&&(s=n));if(l){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,i,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,r){return o.f[r](e,t),t}),[]))}}(),function(){o.u=function(e){return"js/about.a8e898de.js"}}(),function(){o.miniCssF=function(e){return"css/about.9dcd382b.css"}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="rdv:";o.l=function(r,i,n,s){if(e[r])e[r].push(i);else{var l,a;if(void 0!==n)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+n){l=u;break}}l||(a=!0,l=document.createElement("script"),l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.setAttribute("data-webpack",t+n),l.src=r),e[r]=[i];var m=function(t,o){l.onerror=l.onload=null,clearTimeout(p);var i=e[r];if(delete e[r],l.parentNode&&l.parentNode.removeChild(l),i&&i.forEach((function(e){return e(o)})),t)return t(o)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=m.bind(null,l.onerror),l.onload=m.bind(null,l.onload),a&&document.head.appendChild(l)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/rdv/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,o,r,i){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css";var s=function(o){if(n.onerror=n.onload=null,"load"===o.type)r();else{var s=o&&("load"===o.type?"missing":o.type),l=o&&o.target&&o.target.href||t,a=new Error("Loading CSS chunk "+e+" failed.\n("+l+")");a.code="CSS_CHUNK_LOAD_FAILED",a.type=s,a.request=l,n.parentNode&&n.parentNode.removeChild(n),i(a)}};return n.onerror=n.onload=s,n.href=t,o?o.parentNode.insertBefore(n,o.nextSibling):document.head.appendChild(n),n},t=function(e,t){for(var o=document.getElementsByTagName("link"),r=0;r<o.length;r++){var i=o[r],n=i.getAttribute("data-href")||i.getAttribute("href");if("stylesheet"===i.rel&&(n===e||n===t))return i}var s=document.getElementsByTagName("style");for(r=0;r<s.length;r++){i=s[r],n=i.getAttribute("data-href");if(n===e||n===t)return i}},r=function(r){return new Promise((function(i,n){var s=o.miniCssF(r),l=o.p+s;if(t(s,l))return i();e(r,l,null,i,n)}))},i={143:0};o.f.miniCss=function(e,t){var o={443:1};i[e]?t.push(i[e]):0!==i[e]&&o[e]&&t.push(i[e]=r(e).then((function(){i[e]=0}),(function(t){throw delete i[e],t})))}}}(),function(){var e={143:0};o.f.j=function(t,r){var i=o.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var n=new Promise((function(o,r){i=e[t]=[o,r]}));r.push(i[2]=n);var s=o.p+o.u(t),l=new Error,a=function(r){if(o.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var n=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",l.name="ChunkLoadError",l.type=n,l.request=s,i[1](l)}};o.l(s,a,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,n,s=r[0],l=r[1],a=r[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(i in l)o.o(l,i)&&(o.m[i]=l[i]);if(a)var c=a(o)}for(t&&t(r);d<s.length;d++)n=s[d],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(c)},r=self["webpackChunkrdv"]=self["webpackChunkrdv"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=o.O(void 0,[998],(function(){return o(3544)}));r=o.O(r)})();
//# sourceMappingURL=app.accfe09f.js.map