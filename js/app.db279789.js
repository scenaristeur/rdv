(function(){"use strict";var e={4226:function(e,t,o){var i=o(9242),r=o(3396);function l(e,t){const o=(0,r.up)("router-view");return(0,r.wg)(),(0,r.j4)(o)}var s=o(89);const n={},a=(0,s.Z)(n,[["render",l]]);var d=a,c=o(5431);(0,c.z)("/rdv/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh."),alert("This app has been updated, please close the app & re-open")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var u=o(2483);const p={class:"home"};function m(e,t,o,i,l,s){const n=(0,r.up)("WorldMap"),a=(0,r.up)("ProfileView"),d=(0,r.up)("WikipediaView"),c=(0,r.up)("UsersView"),u=(0,r.up)("RdvView"),m=(0,r.up)("RdvUpdater"),f=(0,r.up)("UsersUpdater");return(0,r.wg)(),(0,r.iD)("div",p,[(0,r.Wm)(n,{value:s.view,users:s.users,rdvs:s.rdvs,places:s.places},null,8,["value","users","rdvs","places"]),(0,r.Wm)(a),"wikipedia"==s.view?((0,r.wg)(),(0,r.j4)(d,{key:0})):(0,r.kq)("",!0),"users"==s.view?((0,r.wg)(),(0,r.j4)(c,{key:1})):(0,r.kq)("",!0),"rdv"==s.view?((0,r.wg)(),(0,r.j4)(u,{key:2})):(0,r.kq)("",!0),(0,r.Wm)(m),(0,r.Wm)(f)])}var f=o(7139),v=o(4870),g=o(65),h=o.p+"img/marker.f58b9982.png",w=o.p+"img/marker_selected.9c72dae0.png",A=o.p+"img/here.b7fe6ce7.png",k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADFUlEQVR4Xu2a/bVNMRDF96vAUwE6eCqgA1SADp4KUAEdoAJU8KiADngVoALWb62bta6Y5EySm+uedSZ/3puPmZ2dyew5OdPG29nG/VcAEAzYOAJxBDZOgAiCLUfgtqTnkh5KOm9gTssa1rS/G9b6KemDpJeSvnvGeY27L+l9o+Npfe8aJXtbAEhzAMQjSZ+WQPAYx85/6XSe9T1r1OzsAYD5AOHuEhM8xr2V9HgJycr/njVmAMCc7yQ9qU3uMe7HwO7/TwYkFtwcBcCi4GfP+dot/GKAPQz1jueoWkytbrKHARYARFmvYYP+u4cTqK+M3gHAjCMQDIgjEDEggmDcAu4L6t+ODyRdZD9/lfRxYM6TvwZRkK8WUtOk5p7tcvkWPE4aAPJxnPfKaIAABHSIt00DwGtAqR+xgjpCT5ueb3hS4R7D0xh2/s3IBJKeNjKhabmZAED3bxXaX+9pdYTMrYLlHIc7HTHBBcRMAEp1hF+7QEjpar9RamPMDcPyRV3v8rZVKfVOuhtnqUicZ7fZVavBGmp5OQj0r+r6XltnMYDdpIaYN+p0+c7nfUbGNuMwCwAr8nPm2X1PgwV5TJhyIxwTAKpI3NWeRjX3XtYxAJghwY/JAGjNdeZpXJ/5cVkVA0YC2chYD7h/9ZnFABaxrsGlpKaUPHF9enVEEwgzASglQoBAemslQqTNlqOrTIRKSU3aIWJC+oDJeS9dkUvJU9OO551nMoC1Ni2GEtirl8OH+DIEE14XhI5FYWh/2SiDpxVEDgEAThITAIFrzlJ89MFxgiPOlwRT6cyfPAD7hgOCVRRdEkq1gLcqAIYid2FwABBfh+PzeLwPiAcSRoCMFyK1K8ejBaxECKXn/WxFKWyk5aWx0lzkFSRaTXrHAwAZWSlz8zjmWaM2T+9DyZRZVusIHuM2/1ASnc63+14WeECewQB0Bcei+mjaaxxpJnl6DwjeNUog9BwBnEdvHOSxdDIMJqDta2rOcuKYACQ1iZ0HfS7vCXar7DO6O6t0et/oAGD1WzjoQDBgEMDVDw8GrH4LBx34A8fSukGbT39pAAAAAElFTkSuQmCC",y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADUElEQVR4Xu2a/ZFNQRDFz0aACBABIkAEiAARIAJEgAjYCBABIkAEiAARUD91p+rtrX13pme6+131bv+zW/VmpnvO9MeZvnOiI5eTI9+/NgA2DzhyBA4RAtclXZN0ZYb9d0lfJX3JPJMsAG5Jui/prqSLlQ0CxEdJp9PfUDyiAeCUX0sCgB4BiIeSACVEIgF4JOmlk9WPJb1yWuvMMlEAcOoPnA1+M3mD67IRALydYt3V0Gmxd5LueS7sDQAuj+tHCqFASLiIJwBkeE4/Q/ACvGFYPAH4dk5tHzZwzwJUhasei3sBQMIj8WUK5ZHEOCReAGSeftmwixd4AAC1/Ww8hvcTR4DoIOQPvOiOcZ0bo9TZAwAy8guD4Uuuaw2lJ6NkywMATvFmIwDPJT2rjOX3p43rfRqg2f9UZANwSdKvyua4LP38nwD4E2Bsq1cBJqB2i4cHtAJA4iPZtUgrAMNenAkAjQ6ydotQVaguLTK0h6HJk3WW04K91e729BDgFS2yiiQIG6Pb0yKAdbsy0HKbpGs0dO328AArD+ASAxeYVwOyP3zCsqFV8IAeJsjmAaKEA27f0i+cO88qmCBGsZHLLTHgOOaHx+3TIwTYU0YjZI6dS2PECwBL5vZygpaKUtXlBQCKiGnrba5q4J4BFlK1qMMTAHr/H3p3ZJxHKS1XaePUs8M9AWBlCynqNXyY/Owq9gYgwwvcTh8gvAGI9gLX048CILIiuGT+yBAoa0fwApe6P088ESGADng97PBCb6abzYP1Qblr3SSzuigAMMTzS5Hbl6AsDyh6PMiRG+k5zz0iPcAjFH5PFx531y9gRAMwGgphrp8JALp6qkJI1s/OAbv6aIryOqxFeC3W2hRtWW/vmIwQKMohSIBQK43EPZuvNU+HNp4dAkVfS2kMj/sMJrh0Okvf/lq+Hbqc/KE8YIkfhNb7fahl5oBdG6DK9A5KUiTpcZUOq/drA2CXJPE/CTJ98yg+lAeUAymlLvWB9KGToGsSG13s0B4wav/w/F4ASFitz2KGjWxcgJ6B+dlcLwCWdzyN9g8P6+oXbgB04r55gOEpWyfG5mmpIcAjBstDBvNuOibAJczP6HtzQId965yyAbDOc8mzavOAPKzXqekvWhOGQSnRji0AAAAASUVORK5CYII=",b=o.p+"img/location-pin.889383ad.png";const _={key:0},W={key:1},D={for:"datePicker"},P=(0,r._)("code",null,"When ?",-1),U={key:0},S=(0,r._)("i",null,"7 days max",-1),I=[S],C={role:"group"},V=(0,r._)("label",{for:"input-live"},[(0,r._)("code",null,"Title:")],-1),O=(0,r._)("label",{for:"textarea"},[(0,r._)("code",null,"Description:")],-1),j=(0,r._)("label",{for:"color"},[(0,r._)("code",null,"Color:")],-1);function B(e,t,o,i,l,s){const n=(0,r.up)("VueDatePicker"),a=(0,r.up)("b-form-input"),d=(0,r.up)("b-form-invalid-feedback"),c=(0,r.up)("b-form-text"),u=(0,r.up)("b-form-textarea"),p=(0,r.up)("b-col"),m=(0,r.up)("b-row"),f=(0,r.up)("BModal");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(f,{modelValue:l.showRdvForm,"onUpdate:modelValue":t[4]||(t[4]=e=>l.showRdvForm=e),onOk:s.onAddRdv,size:"lg"},{default:(0,r.w5)((()=>[0==l.edit?((0,r.wg)(),(0,r.iD)("div",_,"Rdv non modifiable")):(0,r.kq)("",!0),null!=s.rdv?((0,r.wg)(),(0,r.iD)("div",W,[(0,r._)("label",D,[P,(0,r.Uk)(),1==l.edit?((0,r.wg)(),(0,r.iD)("small",U,I)):(0,r.kq)("",!0)]),(0,r.Wm)(n,{id:"datePicker",modelValue:l.date,"onUpdate:modelValue":t[0]||(t[0]=e=>l.date=e),range:"","partial-range":"","max-range":"7","format-locale":l.fr,format:"Pp","min-date":new Date,"max-date":new Date((new Date).setDate((new Date).getDate()+15)),disabled:!l.edit},null,8,["modelValue","format-locale","min-date","max-date","disabled"]),(0,r._)("div",C,[V,(0,r.Wm)(a,{id:"input-live",modelValue:s.rdv.title,"onUpdate:modelValue":t[1]||(t[1]=e=>s.rdv.title=e),state:l.stateTitle,onInput:s.titleState,disabled:!l.edit,"aria-describedby":"input-live-help input-live-feedback",placeholder:"Title",trim:""},null,8,["modelValue","state","onInput","disabled"]),(0,r.Wm)(d,{id:"input-live-feedback"},{default:(0,r.w5)((()=>[(0,r.Uk)(" Enter at least 3 and less than 50 letters ")])),_:1}),(0,r.Wm)(c,{id:"input-live-help"},{default:(0,r.w5)((()=>[(0,r.Uk)("A cool title for your event.")])),_:1})]),O,(0,r.Wm)(u,{id:"textarea",modelValue:s.rdv.description,"onUpdate:modelValue":t[2]||(t[2]=e=>s.rdv.description=e),placeholder:"Description",rows:"3","max-rows":"6",disabled:!l.edit},null,8,["modelValue","disabled"]),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(p,null,{default:(0,r.w5)((()=>[j,(0,r.Wm)(a,{id:"color",modelValue:s.rdv.color,"onUpdate:modelValue":t[3]||(t[3]=e=>s.rdv.color=e),disabled:!l.edit,type:"color"},null,8,["modelValue","disabled"])])),_:1})])),_:1})])):(0,r.kq)("",!0)])),_:1},8,["modelValue","onOk"])])}var M=o(2108),E=o(8014),T={name:"RdvForm",components:{VueDatePicker:M.Z},data(){return{showRdvForm:!1,fr:E.Z,edit:!0,date:null,stateTitle:!1}},methods:{onAddRdv(){console.log(this.date),null==this.date[1]&&(this.date[1]=this.date[0]),this.rdv.start=this.date[0].toString(),this.rdv.end=this.date[1].toString(),this.rdv.updated=Date.now(),console.log(this.rdv),this.$store.dispatch("core/updateYstoreRdvs",this.rdv)},titleState(){this.stateTitle=1!=this.edit||this.rdv.title.length>2&&this.rdv.title.length<51}},watch:{rdv(){this.showRdvForm=null!=this.rdv,void 0!=this.rdv.start?(this.date=[this.rdv.start,this.rdv.end],console.log(this.date),this.edit=!1):this.edit=!0}},computed:{rdv(){return this.$store.state.core.rdv}}};const x=(0,s.Z)(T,[["render",B]]);var R=x,H={__name:"WorldMap",props:{users:{type:[Array]},rdvs:{type:[Array]},places:{type:[Array]}},setup(e){const t=e,o=(0,r.f3)("ol-feature"),i=(0,r.f3)("ol-geom"),l=(0,v.iH)([2.58,45]),s=(0,v.iH)("EPSG:4326"),n=(0,v.iH)(15),a=(0,v.iH)(0),d=(0,v.iH)("white"),c=(0,v.iH)(1),u=(0,v.iH)(10),p=(0,g.oR)(),m=(0,v.iH)(),_=(0,v.iH)([]),W=(0,v.iH)(!0),D=(0,v.iH)([]),P=(0,v.iH)([]);try{const e=localStorage.getItem("rdv_map_view");let t=JSON.parse(e);n.value=t.zoom,l.value=t.center}catch(B){console.log(B)}const U=(0,v.iH)([]);(0,r.YP)((()=>t.users),(()=>{console.log("prop users changed",t.users)})),(0,r.YP)((()=>t.rdvs),(()=>{console.log("prop rdvs changed",t.rdvs);for(let e of Object.values(t.rdvs)){console.log("-----",e.uuid,e.title,e);const t=new o({geometry:new i.Point(e.coordinates),name:e.title,uuid:e.uuid,data:e});D.value.source.addFeature(t)}})),(0,r.YP)((()=>t.places),(()=>{console.log("prop places changed",t.places),P.value.source.clear();for(let e of Object.values(t.places)){console.log("-----",e);const t=new o({geometry:new i.Point([e.lon,e.lat]),name:e.title});P.value.source.addFeature(t)}}));const S=e=>{_.value=e.target.getPosition(),p.commit("core/updateMyPosition",_.value),1==W.value&&m.value?.setCenter(e.target?.getPosition()),localStorage.setItem("rdv_map_view",JSON.stringify({center:m.value.getCenter(),zoom:m.value.getZoom()}))},I=(0,r.Fl)((()=>p.state.core.centerPoint));(0,r.YP)(I,(e=>{m.value?.setCenter(e)}));const C=(0,r.f3)("ol-selectconditions"),V=C.click,O=e=>{if(e.selected.length>0){let t=e.selected[0],o=t.get("uuid"),i=t.get("title");console.log("selected",t,o,i);let r=t.get("name"),l=t.get("data");console.log(r,l,l.description,l.color),p.commit("core/setRdv",l)}},j=(e,t)=>{let o=e.get("color");void 0!=t.getImage().getFill&&t.getImage().getFill().setColor(o);let i=e.get("name");t.getText().setText(i)};return U.value=[{text:"Centrer la carte ici",icon:k,classname:"some-style-class",callback:e=>{m.value.setCenter(e.coordinate)}},{text:"Ajouter un rdv",classname:"some-style-class",icon:y,callback:e=>{console.log(e),p.commit("core/setRdv",{coordinates:e.coordinate})}},"-"],(t,o)=>{const i=(0,r.up)("BButton"),p=(0,r.up)("b-button-group"),g=(0,r.up)("ol-view"),k=(0,r.up)("ol-source-osm"),y=(0,r.up)("ol-tile-layer"),I=(0,r.up)("ol-style-fill"),C=(0,r.up)("ol-style-icon"),B=(0,r.up)("ol-style-text"),M=(0,r.up)("ol-style"),E=(0,r.up)("ol-interaction-select"),T=(0,r.up)("ol-context-menu-control"),x=(0,r.up)("ol-geom-point"),H=(0,r.up)("ol-feature"),F=(0,r.up)("ol-source-vector"),K=(0,r.up)("ol-vector-layer"),z=(0,r.up)("ol-geolocation"),Z=(0,r.up)("ol-geom-multi-point"),q=(0,r.up)("ol-style-stroke"),Y=(0,r.up)("ol-style-circle"),J=(0,r.up)("ol-map");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(p,{size:"sm",class:"map-toolbar"},{default:(0,r.w5)((()=>[(0,r.Wm)(i,{onClick:o[0]||(o[0]=e=>W.value=!W.value),variant:1==W.value?"warning":"success"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,f.zw)(1==W.value?"don't follow me":"follow me"),1)])),_:1},8,["variant"])])),_:1}),(0,r.Wm)(J,{loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,style:{height:"400px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{ref_key:"view",ref:m,center:l.value,rotation:a.value,zoom:n.value,projection:s.value},null,8,["center","rotation","zoom","projection"]),(0,r.Wm)(y,null,{default:(0,r.w5)((()=>[(0,r.Wm)(k)])),_:1}),(0,r.Wm)(E,{onSelect:O,condition:(0,v.SU)(V),features:t.selectedFeatures},{default:(0,r.w5)((()=>[(0,r.Wm)(M,{overrideStyleFunction:j},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{color:d.value},null,8,["color"]),(0,r.Wm)(C,{src:(0,v.SU)(w),scale:.1},null,8,["src"]),(0,r.Wm)(B,{color:"white",text:"Hellooooo"})])),_:1})])),_:1},8,["condition","features"]),(0,r.Wm)(T,{items:U.value},null,8,["items"]),(0,r.Wm)(z,{projection:s.value,"onChange:position":S},{default:(0,r.w5)((()=>[(0,r._)("template",null,[(0,r.Wm)(K,{zIndex:2},{default:(0,r.w5)((()=>[(0,r.Wm)(F,null,{default:(0,r.w5)((()=>[(0,r.Wm)(H,{ref:"positionFeature"},{default:(0,r.w5)((()=>[(0,r.Wm)(x,{coordinates:_.value},null,8,["coordinates"]),(0,r.Wm)(M,null,{default:(0,r.w5)((()=>[(0,r.Wm)(C,{src:(0,v.SU)(A),scale:.1},null,8,["src"])])),_:1})])),_:1},512)])),_:1})])),_:1})])])),_:1},8,["projection"]),(0,r.Wm)(K,null,{default:(0,r.w5)((()=>[(0,r.Wm)(F,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.users,((e,t)=>((0,r.wg)(),(0,r.j4)(H,{key:t},{default:(0,r.w5)((()=>[void 0!=e.position?((0,r.wg)(),(0,r.j4)(Z,{key:0,coordinates:e.position.coordinates},null,8,["coordinates"])):(0,r.kq)("",!0),(0,r.Wm)(M,null,{default:(0,r.w5)((()=>[(0,r.Wm)(Y,{radius:u.value},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{color:d.value},null,8,["color"]),(0,r.Wm)(q,{color:e.profile.color,width:c.value},null,8,["color","width"]),(0,r.Wm)(B,{text:e.profile.name},null,8,["text"])])),_:2},1032,["radius"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,r.Wm)(K,null,{default:(0,r.w5)((()=>[(0,r.Wm)(F,{ref_key:"rdvMarkers",ref:D},null,512),(0,r.Wm)(M,{overrideStyleFunction:j},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{color:d.value},null,8,["color"]),(0,r.Wm)(C,{src:(0,v.SU)(h),scale:.05},null,8,["src"]),(0,r.Wm)(B,{text:"Hellooooo"})])),_:1})])),_:1}),(0,r.Wm)(K,null,{default:(0,r.w5)((()=>[(0,r.Wm)(F,{ref_key:"placeMarkers",ref:P},null,512),(0,r.Wm)(M,{overrideStyleFunction:j},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{color:d.value},null,8,["color"]),(0,r.Wm)(C,{src:(0,v.SU)(b),scale:.05},null,8,["src"]),(0,r.Wm)(B,{text:"Hellooooo"})])),_:1})])),_:1})])),_:1}),(0,r.Wm)(R)],64)}}};const F=(0,s.Z)(H,[["__scopeId","data-v-72555050"]]);var K=F;const z={class:"row"},Z=(0,r._)("label",{class:"col-form-label col-2",for:"inline-form-input-name"},"Nom",-1),q={class:"col-8"},Y={class:"col-2"},J={class:"row"},G=(0,r._)("label",{class:"col-form-label col-2",for:"inline-form-input-profile"},"Profil",-1),L={class:"col-8"},N={class:"col-2"},$={style:{"margin-bottom":"30px"}},Q=["onClick"],X={key:0,class:"row"},ee=(0,r._)("label",{class:"col-form-label col-2",for:"inline-form-input-profile"},"intérêt",-1),te={class:"col-8"},oe={class:"col-2"};function ie(e,t,o,l,s,n){const a=(0,r.up)("BButton"),d=(0,r.up)("b-button-group"),c=(0,r.up)("b-button"),u=(0,r.up)("BFormInput"),p=(0,r.up)("BListGroupItem"),m=(0,r.up)("BListGroup"),v=(0,r.up)("BForm"),g=(0,r.up)("BModal");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(d,null,{default:(0,r.w5)((()=>[(0,r.Wm)(a,{onClick:t[0]||(t[0]=e=>s.showProfile=!s.showProfile),variant:"info"},{default:(0,r.w5)((()=>[(0,r.Uk)(" Profil")])),_:1})])),_:1}),(0,r.Uk)("    "),(0,r.Wm)(d,null,{default:(0,r.w5)((()=>[(0,r.Wm)(c,{onClick:t[1]||(t[1]=e=>n.setView("users"))},{default:(0,r.w5)((()=>[(0,r.Uk)("Users")])),_:1}),(0,r.Wm)(c,{onClick:t[2]||(t[2]=e=>n.setView("rdv"))},{default:(0,r.w5)((()=>[(0,r.Uk)("Rdv")])),_:1}),(0,r.Wm)(c,{onClick:t[3]||(t[3]=e=>n.setView("wikipedia"))},{default:(0,r.w5)((()=>[(0,r.Uk)("Wikipedia")])),_:1})])),_:1}),(0,r.Wm)(g,{modelValue:s.showProfile,"onUpdate:modelValue":t[8]||(t[8]=e=>s.showProfile=e),onOk:n.updateUser},{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r._)("div",z,[Z,(0,r._)("div",q,[(0,r.Wm)(u,{id:"inline-form-input-name",class:"mb-2 me-sm-2 mb-sm-0",modelValue:s.user.name,"onUpdate:modelValue":t[4]||(t[4]=e=>s.user.name=e),placeholder:"username"},null,8,["modelValue"])]),(0,r._)("div",Y,[(0,r.Wm)(u,{modelValue:s.user.color,"onUpdate:modelValue":t[5]||(t[5]=e=>s.user.color=e),type:"color"},null,8,["modelValue"])])]),(0,r._)("div",J,[G,(0,r._)("div",L,[(0,r.Wm)(u,{id:"inline-form-input-profile",modelValue:s.profile_name,"onUpdate:modelValue":t[6]||(t[6]=e=>s.profile_name=e),placeholder:"profile name",onKeyup:(0,i.D2)(n.addProfile,["enter"])},null,8,["modelValue","onKeyup"])]),(0,r._)("div",N,[(0,r.Wm)(a,{onClick:n.addProfile},{default:(0,r.w5)((()=>[(0,r.Uk)(" +")])),_:1},8,["onClick"])])]),(0,r.Uk)(" "+(0,f.zw)(n.profile)+" ",1),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(n.profiles,(e=>((0,r.wg)(),(0,r.j4)(p,{key:e.id,href:"#",active:n.profile==e.id,onClick:t=>n.changeProfile(e.id)},{default:(0,r.w5)((()=>[(0,r._)("h6",$,(0,f.zw)(e.name),1),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.interests,(t=>((0,r.wg)(),(0,r.iD)("button",{key:t,type:"button",class:"btn btn-dark position-relative",style:{"margin-right":"'5px'"}},[(0,r.Uk)((0,f.zw)(t)+" ",1),(0,r._)("span",{class:"position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle",onClick:o=>n.remove_interest({profil:e.id,interest:t})}," X ",8,Q)])))),128)),e.interests.length<5?((0,r.wg)(),(0,r.iD)("div",X,[ee,(0,r._)("div",te,[(0,r.Wm)(u,{modelValue:s.new_interest,"onUpdate:modelValue":t[7]||(t[7]=e=>s.new_interest=e),value:s.new_interest,placeholder:"nouvel interêt",onKeyup:(0,i.D2)((t=>n.addInteret({profil:e.id})),["enter"])},null,8,["modelValue","value","onKeyup"])]),(0,r._)("div",oe,[(0,r.Wm)(a,{onClick:t=>n.addInteret({profil:e.id})},{default:(0,r.w5)((()=>[(0,r.Uk)(" +")])),_:2},1032,["onClick"])])])):(0,r.kq)("",!0)])),_:2},1032,["active","onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue","onOk"])])}o(7658);var re=o(5288),le=o(9373),se=o(2213),ne=o(114);const ae={rdvs:{}},de=(0,re.wI)(ae),ce=(0,re.ms)(de),ue=new ne.GL(ce),pe=new le.x$("rdv",ce,{awareness:ue,signaling:["wss://noosld-webrtc.glitch.me"]}),me=new se.VU("wss://yjs-leveldb.glitch.me/rdv","rdv",ce,{awareness:ue});pe.on("status",(e=>{console.log("** webrtcProvider in y_store",e.status)})),me.on("status",(e=>{console.log("## websocketProvider in y_store",e.status)}));var fe={name:"ProfileView",data(){return{showProfile:!1,user:{name:"user_"+Date.now(),color:"#ffb61e",clientID:ue.clientID},profile_name:"",interests:"",new_interest:""}},created(){let e=JSON.parse(localStorage.getItem("rdv_user"));if(console.log("localstorage user",e),e&&e.name&&e.color){this.user=e;let t=JSON.parse(localStorage.getItem("rdv_user_interests"));void 0!=t&&(console.log("from localstorage",t.profiles,t.profile),this.$store.commit("core/setProfiles",t.profiles),this.$store.commit("core/setProfile",t.profile))}ue.setLocalStateField("profile",this.user),this.updateInterests()},methods:{addInteret(e){if(this.new_interest.trim().length>0){console.log(this.new_interest,e);let t=this.profiles.find((t=>t.id==e.profil));t.interests.push(this.new_interest),this.new_interest="",console.log(t)}else alert("Ajoutez un centre d'intérêts")},remove_interest(e){console.log("remove",e.interest);let t=this.profiles.find((t=>t.id==e.profil));t.interests=t.interests.filter((t=>t!=e.interest))},onInputEventHandler(e){console.log(e),console.log(this.interests)},addProfile(){if(this.profile_name.trim().length>0){let e={name:this.profile_name,interests:[]};this.$store.commit("core/addProfile",e),this.profile_name=""}else alert("ajoutez un nom de profil")},setView(e){this.$store.commit("core/setView",e)},updateUser(){console.log("User",this.user),ue.setLocalStateField("profile",this.user),localStorage.setItem("rdv_user",JSON.stringify(this.user)),this.updateInterests()},changeProfile(e){console.log(e),this.$store.commit("core/setProfile",e)},updateInterests(){console.log("update interests"),ue.setLocalStateField("interests",{like:this.profiles.find((e=>e.id==this.profile))}),localStorage.setItem("rdv_user_interests",JSON.stringify({profiles:this.profiles,profile:this.profile}))}},watch:{profiles(){this.updateInterests()},profile(){this.updateInterests()}},computed:{profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile}}};const ve=(0,s.Z)(fe,[["render",ie]]);var ge=ve;const he={class:"row"},we={class:"col"},Ae={key:0,class:"col"},ke={class:"col"},ye={key:0};function be(e,t,o,i,l,s){const n=(0,r.up)("BBadge"),a=(0,r.up)("BListGroupItem"),d=(0,r.up)("BListGroup");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(d,{class:"scroll_list"},{default:(0,r.w5)((()=>[(0,r._)("div",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.users,(e=>((0,r.wg)(),(0,r.j4)(a,{key:e.profile.clientID,href:"#",onClick:t=>s.userClicked(e)},{default:(0,r.w5)((()=>[(0,r._)("h2",null,(0,f.zw)(e.profile.name),1),(0,r._)("div",he,[(0,r._)("div",we,[(0,r._)("div",{class:"user_color",style:(0,f.j5)("width:20px;height:20px;background-color:"+e.profile.color)},null,4)]),void 0!=e.distance?((0,r.wg)(),(0,r.iD)("div",Ae,(0,f.zw)(e.distance>1?e.distance+" km":Math.floor(1e3*e.distance)+" m"),1)):(0,r.kq)("",!0),(0,r._)("div",ke,[void 0!=e.interests&&void 0!=e.interests.like&&void 0!=e.interests.like.interests&&s.profiles.length>0?((0,r.wg)(),(0,r.iD)("div",ye,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.interests.like.interests,(e=>((0,r.wg)(),(0,r.j4)(n,{key:e,variant:s.getInterestVariant(e)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,f.zw)(e),1)])),_:2},1032,["variant"])))),128))])):(0,r.kq)("",!0)])])])),_:2},1032,["onClick"])))),128))])])),_:1})])}var _e={name:"UsersView",methods:{userClicked(e){console.log(e),void 0!=e.position&&this.$store.commit("core/centerToPoint",e.position.coordinates)},getInterestVariant(e){let t=this.profiles.find((e=>e.id==this.profile));return void 0!=t&&t.interests.includes(e)?"info":"light"}},computed:{profiles(){return this.$store.state.core.profiles},profile(){return this.$store.state.core.profile},users(){return this.$store.state.core.users}}};const We=(0,s.Z)(_e,[["render",be],["__scopeId","data-v-67f5aeaa"]]);var De=We;const Pe=(0,r._)("p",null,"Clic droit sur la carte pour ajouter un rendez-vous.",-1),Ue=(0,r._)("br",null,null,-1),Se={key:0},Ie=(0,r._)("br",null,null,-1);function Ce(e,t,o,i,l,s){const n=(0,r.up)("AdresseView"),a=(0,r.up)("BListGroupItem"),d=(0,r.up)("BListGroup");return(0,r.wg)(),(0,r.iD)("div",null,[Pe,(0,r.Wm)(d,{class:"scroll_list"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.rdvs,(e=>((0,r.wg)(),(0,r.j4)(a,{key:e.uuid,button:"",onClick:t=>s.rdvSelected(e)},{default:(0,r.w5)((()=>[(0,r._)("h4",null,(0,f.zw)(e.title),1),(0,r._)("small",null,(0,f.zw)(new Date(e.start).toLocaleString())+" -> "+(0,f.zw)(new Date(e.end).toLocaleString()),1),Ue,(0,r.Uk)(" "+(0,f.zw)(e.description)+" ",1),void 0!=e.distance?((0,r.wg)(),(0,r.iD)("span",Se,[Ie,(0,r.Uk)((0,f.zw)(e.distance>1?e.distance+" km":Math.floor(1e3*e.distance)+" m"),1)])):(0,r.kq)("",!0),(0,r.Wm)(n,{coordinates:e.coordinates},null,8,["coordinates"])])),_:2},1032,["onClick"])))),128))])),_:1})])}const Ve={key:1};function Oe(e,t,o,l,s,n){return 0==s.adresseShow?((0,r.wg)(),(0,r.iD)("button",{key:0,onClick:t[0]||(t[0]=(0,i.iM)(((...e)=>n.showAdresse&&n.showAdresse(...e)),["stop"]))},"adresse")):((0,r.wg)(),(0,r.iD)("div",Ve,[(0,r.Uk)((0,f.zw)(s.adresse)+" ",1),(0,r._)("button",{onClick:t[1]||(t[1]=(0,i.iM)((e=>s.adresseShow=!1),["stop"]))},"cacher")]))}var je={name:"AdresseView",props:["coordinates"],data(){return{adresse:null,adresseShow:!1}},methods:{async showAdresse(){this.adresseShow=!0;let e=await this.adress(this.coordinates);this.adresse=e.display_name},async adress([e,t]){let o="https://nominatim.openstreetmap.org/reverse?lat="+t+"&lon="+e+"&format=json";console.log(o);let i=await fetch(o);return i.json()}},computed:{}};const Be=(0,s.Z)(je,[["render",Oe]]);var Me=Be,Ee={name:"RdvView",components:{AdresseView:Me},methods:{rdvSelected(e){this.$store.commit("core/centerToPoint",e.coordinates)},withDistances(e){let t=e.map((e=>{var t=Object.assign({},e);if(void 0!=e.coordinates&&void 0!=this.myPosition){const o=this.$getDistanceFromLatLonInKm(this.myPosition[0],this.myPosition[1],e.coordinates[0],e.coordinates[1]).toFixed(3);t.distance=o}return t}));return t.sort((function(e,t){return e.distance-t.distance}))}},computed:{rdvs(){return console.log("rdvs",this.rdvs),this.withDistances(this.$store.state.core.rdvs)},myPosition(){return this.$store.state.core.myPosition}}};const Te=(0,s.Z)(Ee,[["render",Ce]]);var xe=Te;function Re(e,t,o,i,l,s){return(0,r.wg)(),(0,r.iD)("div")}var He=o(6866);(0,re.QB)(He);var Fe={name:"RdvUpdater",created(){console.log("RDV CREATED !!!!!!!!!!!!!!!!!!!!!",ue),(0,re.QT)(de.rdvs,this.rdvsUpdate)},methods:{rdvsUpdate(){let e=[];for(let[t,o]of Object.entries(de.rdvs)){let i=Date.parse(o.end),r=Date.now();if(console.log(o.title,o.end,i,r,i-r),i<r)return console.log("DELETE old rdv",t),void delete de.rdvs[t];e.push(o)}this.$store.commit("core/setRdvs",e)},rdvsUpdate1(){let e=[];for(let[t,o]of Object.entries(de.rdvs))if(t!=ue.clientID){console.log("coordin",t,o.coordinates[0],o.coordinates[1],o.title),console.log("dates",t,o.end_date,o.end_time);let i=o.end_date+"T"+o.end_time;console.log("iso",i);let r=new Date(i),l=Date.now();console.log(l,r);let s=r.getTime()-l;if(s<0)return console.log("diff delete",s),void delete de.rdvs[t];void 0!=o.end_date&&void 0!=o.end_time?e.push(o):(console.log(t,"no end_date"),delete de.rdvs[t])}this.$store.commit("core/setRdvs",e)}}};const Ke=(0,s.Z)(Fe,[["render",Re]]);var ze=Ke;function Ze(e,t,o,i,l,s){return(0,r.wg)(),(0,r.iD)("span")}var qe={name:"UsersUpdater",data(){return{}},created(){ue.on("change",(e=>{console.log("--changes",e),this.updateUsers(Array.from(ue.getStates().values()).filter((e=>void 0!=e.profile&&e.profile.clientID!=ue.clientID)))})),this.updateUsers(Array.from(ue.getStates().values()).filter((e=>void 0!=e.profile&&e.profile.clientID!=ue.clientID)))},methods:{updateUsers(e){console.log("UPDATE USERS"),this.users=this.withDistances(e).sort((function(e,t){return e.distance-t.distance})),this.$store.commit("core/setUsers",this.users)},withDistances(e){let t=e.map((e=>{var t=Object.assign({},e);if(void 0!=e.position&&void 0!=this.myPosition){const o=this.$getDistanceFromLatLonInKm(this.myPosition[0],this.myPosition[1],e.position.coordinates[0],e.position.coordinates[1]).toFixed(3);t.distance=o}return t}));return t}},computed:{myPosition(){return this.$store.state.core.myPosition}}};const Ye=(0,s.Z)(qe,[["render",Ze]]);var Je=Ye;function Ge(e,t,o,i,l,s){const n=(0,r.up)("BListGroupItem"),a=(0,r.up)("BListGroup");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r._)("div",null,[0==s.places.length?((0,r.wg)(),(0,r.iD)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>s.getWikipedia&&s.getWikipedia(...e))},"Afficher les endroits wikipedia voisins")):((0,r.wg)(),(0,r.iD)("button",{key:1,onClick:t[1]||(t[1]=(...e)=>s.hideWikipedia&&s.hideWikipedia(...e))},"Masquer les emplacements wikipedia"))]),s.places.length>0?((0,r.wg)(),(0,r.j4)(a,{key:0,class:"scroll_list"},{default:(0,r.w5)((()=>[(0,r._)("div",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.places,(e=>((0,r.wg)(),(0,r.j4)(n,{key:e.pageid,href:"#",onClick:t=>s.wikipediaClicked(e)},{default:(0,r.w5)((()=>[(0,r.Uk)((0,f.zw)(e.title)+" à "+(0,f.zw)(e.dist)+" m ",1)])),_:2},1032,["onClick"])))),128))])])),_:1})):(0,r.kq)("",!0)])}var Le={name:"WikipediaView",data(){return{}},methods:{async getWikipedia(){await this.$store.commit("core/getWikipedia")},hideWikipedia(){this.$store.commit("core/removeWikipedia")},wikipediaClicked(e){console.log(e),this.$store.commit("core/centerToPoint",[e.lon,e.lat])}},computed:{places(){return this.$store.state.core.places}}};const Ne=(0,s.Z)(Le,[["render",Ge]]);var $e=Ne,Qe={name:"MapView",components:{WorldMap:K,ProfileView:ge,UsersView:De,RdvView:xe,RdvUpdater:ze,UsersUpdater:Je,WikipediaView:$e},computed:{view(){return this.$store.state.core.view},users(){return this.$store.state.core.users},rdvs(){return this.$store.state.core.rdvs},places(){return this.$store.state.core.places}}};const Xe=(0,s.Z)(Qe,[["render",m]]);var et=Xe;const tt=[{path:"/",name:"home",component:et},{path:"/about",name:"about",component:()=>o.e(443).then(o.bind(o,2995))}],ot=(0,u.p7)({history:(0,u.PO)("/rdv/"),routes:tt});var it=ot,rt=o(3029);const lt=()=>({level:0,profiles:[],profile:null,myPosition:[],users:[],centerPoint:null,view:"users",rdvs:[],rdv:null,positionUpdated:null,wikipedia_api_url:"https://fr.wikipedia.org/w/api.php?origin=*",places:[],wikipedia_params:{action:"query",list:"geosearch",gscoord:null,prop:"coordinates|pageimages",gsradius:1e4,gslimit:100,format:"json"}}),st={async updateMyPosition(e,t){console.log("position update",t),e.myPosition=t,console.log("delay ",Date.now()-e.positionUpdated),Date.now()-e.positionUpdated>1e4&&(e.positionUpdated=Date.now(),ue.setLocalStateField("position",{coordinates:t,updated:e.positionUpdated}))},async getWikipedia(e){let t=await this.dispatch("core/getWikipedia",e.myPosition);console.log(t),e.places=t},async removeWikipedia(e){e.places=[]},setUsers(e,t){e.users=t},setRdv(e,t){void 0==t.uuid&&(t.uuid=(0,rt.Z)()),void 0==t.author&&(t.author=ue.clientID),e.rdv=t},setProfiles(e,t){e.profiles=t},setProfile(e,t){e.profile=t},centerToPoint(e,t){e.centerPoint=t},addProfile(e,t){t.id=(0,rt.Z)(),e.profiles.push(t)},setView(e,t){e.view=t},setRdvs(e,t){e.rdvs=t}},nt={increment(e,t){e.commit("increment",t)},updateYstoreRdvs(e,t){de.rdvs[t.uuid]=t},async getWikipedia(e,t){let o=e.state.wikipedia_params,i=e.state.wikipedia_api_url;return o.gscoord=t[1]+"|"+t[0],Object.keys(o).forEach((function(e){i+="&"+e+"="+o[e]})),console.log("url",i),fetch(i).then((function(e){return console.log(e),e.json()})).then((e=>(console.log(e),e.query.geosearch))).catch((function(e){console.log(e)}))}};var at={namespaced:!0,state:lt,actions:nt,mutations:st},dt=(0,g.MT)({state:{},getters:{},mutations:{},actions:{},modules:{core:at}}),ct={install(e,t){console.log(e,t);let o=t.store;console.log(o),e.config.globalProperties.$getDistanceFromLatLonInKm=(t,o,i,r)=>{var l=6371,s=e.config.globalProperties.$deg2rad(i-t),n=e.config.globalProperties.$deg2rad(r-o),a=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e.config.globalProperties.$deg2rad(t))*Math.cos(e.config.globalProperties.$deg2rad(i))*Math.sin(n/2)*Math.sin(n/2),d=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),c=l*d;return c},e.config.globalProperties.$deg2rad=e=>e*(Math.PI/180)}},ut=o(2026),pt=o(8784);(0,i.ri)(d).use(dt).use(it).use(ut.ZP).use(de).use(ct,{store:dt}).use(pt.ZP).mount("#app")}},t={};function o(i){var r=t[i];if(void 0!==r)return r.exports;var l=t[i]={exports:{}};return e[i].call(l.exports,l,l.exports,o),l.exports}o.m=e,function(){var e=[];o.O=function(t,i,r,l){if(!i){var s=1/0;for(c=0;c<e.length;c++){i=e[c][0],r=e[c][1],l=e[c][2];for(var n=!0,a=0;a<i.length;a++)(!1&l||s>=l)&&Object.keys(o.O).every((function(e){return o.O[e](i[a])}))?i.splice(a--,1):(n=!1,l<s&&(s=l));if(n){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[i,r,l]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,i){return o.f[i](e,t),t}),[]))}}(),function(){o.u=function(e){return"js/about.dfe66140.js"}}(),function(){o.miniCssF=function(e){}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="rdv:";o.l=function(i,r,l,s){if(e[i])e[i].push(r);else{var n,a;if(void 0!==l)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+l){n=u;break}}n||(a=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,o.nc&&n.setAttribute("nonce",o.nc),n.setAttribute("data-webpack",t+l),n.src=i),e[i]=[r];var p=function(t,o){n.onerror=n.onload=null,clearTimeout(m);var r=e[i];if(delete e[i],n.parentNode&&n.parentNode.removeChild(n),r&&r.forEach((function(e){return e(o)})),t)return t(o)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=p.bind(null,n.onerror),n.onload=p.bind(null,n.onload),a&&document.head.appendChild(n)}}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.p="/rdv/"}(),function(){var e={143:0};o.f.j=function(t,i){var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var l=new Promise((function(o,i){r=e[t]=[o,i]}));i.push(r[2]=l);var s=o.p+o.u(t),n=new Error,a=function(i){if(o.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var l=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;n.message="Loading chunk "+t+" failed.\n("+l+": "+s+")",n.name="ChunkLoadError",n.type=l,n.request=s,r[1](n)}};o.l(s,a,"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,l,s=i[0],n=i[1],a=i[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(r in n)o.o(n,r)&&(o.m[r]=n[r]);if(a)var c=a(o)}for(t&&t(i);d<s.length;d++)l=s[d],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(c)},i=self["webpackChunkrdv"]=self["webpackChunkrdv"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=o.O(void 0,[998],(function(){return o(4226)}));i=o.O(i)})();
//# sourceMappingURL=app.db279789.js.map